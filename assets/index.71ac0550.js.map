{"version":3,"file":"index.71ac0550.js","sources":["../../src/components/Config.tsx","../../src/components/Octicon.tsx","../../src/Version.ts","../../src/Fix.ts","../../src/fixes/1.17/Carver.ts","../../src/fixes/1.17/DimensionType.ts","../../src/fixes/1.17/Feature.ts","../../src/fixes/1.17/Function.ts","../../src/fixes/1.17/Ids.ts","../../src/fixes/1.17/NoiseSettings.ts","../../src/fixes/1.17/Predicates.ts","../../src/fixes/1.17/StructureFeature.ts","../../src/fixes/1.17/index.ts","../../src/fixes/1.18/Feature.ts","../../src/fixes/1.18/FeatureCycles.ts","../../src/fixes/1.18/NoiseSettings.ts","../../src/fixes/1.18/index.ts","../../src/fixes/1.18.2/Dimension.ts","../../src/fixes/1.18.2/DimensionType.ts","../../src/fixes/1.18.2/NoiseSettings.ts","../../src/fixes/1.18.2/Predicates.ts","../../src/fixes/1.18.2/index.ts","../../src/fixes/21w44a/Advancement.ts","../../src/fixes/21w44a/Biome.ts","../../src/fixes/21w44a/Dimension.ts","../../src/fixes/21w44a/Feature.ts","../../src/fixes/21w44a/index.ts","../../src/fixes/index.ts","../../src/fixes/ParseErrors.ts","../../src/Pack.ts","../../src/components/PackCard.tsx","../../src/components/VersionPicker.tsx","../../src/Store.ts","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["\n\nexport function Config({ name, value, onChange }: { name: string, value: boolean, onChange: (value: boolean) => unknown }) {\n\treturn <label class=\"config\">\t\n\t\t<input type=\"checkbox\" checked={value} onChange={(e) => onChange((e.target as any).checked )} />\n\t\t{name}\n\t</label>\n}\n","export const Octicon = {\n\talert: <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z\"></path></svg>,\n\tdownload: <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M7.47 10.78a.75.75 0 001.06 0l3.75-3.75a.75.75 0 00-1.06-1.06L8.75 8.44V1.75a.75.75 0 00-1.5 0v6.69L4.78 5.97a.75.75 0 00-1.06 1.06l3.75 3.75zM3.75 13a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5z\"></path></svg>,\n\treport: <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M1.75 1.5a.25.25 0 00-.25.25v9.5c0 .138.112.25.25.25h2a.75.75 0 01.75.75v2.19l2.72-2.72a.75.75 0 01.53-.22h6.5a.25.25 0 00.25-.25v-9.5a.25.25 0 00-.25-.25H1.75zM0 1.75C0 .784.784 0 1.75 0h12.5C15.216 0 16 .784 16 1.75v9.5A1.75 1.75 0 0114.25 13H8.06l-2.573 2.573A1.457 1.457 0 013 14.543V13H1.75A1.75 1.75 0 010 11.25v-9.5zM9 9a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z\"></path></svg>,\n\tsync: <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z\"></path></svg>,\t\n\tx: <svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z\"></path></svg>,\n}\n","export const Versions = ['1.16.5', '1.17.1', '21w44a', '1.18.1', '1.18.2'] as const\nexport type Version = typeof Versions[number]\n\nexport namespace Version {\n\texport const DEFAULT_SOURCE: Version = '1.17.1'\n\texport const DEFAULT_TARGET: Version = '1.18.1'\n\n\texport function ord(version: Version): number {\n\t\treturn Versions.indexOf(version)\n\t}\n\n\texport function order(before: Version, after: Version) {\n\t\treturn ord(before) < ord(after)\n\t}\n\n\texport function includes(source: Version, target: Version, from: Version, to: Version) {\n\t\treturn ord(source) < ord(to) && ord(target) > ord(from)\n\t}\n\n\texport function includesInclusive(source: Version, target: Version, from: Version, to: Version) {\n\t\treturn ord(source) <= ord(to) && ord(target) >= ord(from)\n\t}\n}\n","import type { categories, Pack, PackFile } from './Pack'\nimport { Version } from './Version'\n\nexport type Fix = (pack: Pack, ctx: FixContext) => Promise<unknown>\n\nexport namespace Fix {\n\t/**\n\t * Runs each fix after each other\n\t */\n\texport function all(...fixes: Fix[]): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tfor (const fix of fixes) {\n\t\t\t\tawait fix(pack, ctx)\n\t\t\t}\n\t\t}\n\t}\n\n\t/**\n\t * A simple fix that runs on one file category\n\t */\n\texport function onFile(category: typeof categories[number] | 'functions', fix: (file: PackFile, ctx: FixContext) => unknown): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tfor (const file of pack.data[category]) {\n\t\t\t\tif (file.error) continue\n\t\t\t\tconst fileCtx: FixContext = {\n\t\t\t\t\t...ctx,\n\t\t\t\t\twarn: (message: string) => ctx.warn(message, [file.name]),\n\t\t\t\t}\n\t\t\t\ttry {\n\t\t\t\t\tawait fix(file, fileCtx)\n\t\t\t\t} catch (e: any) {\n\t\t\t\t\te.message = `Error fixing ${category.replace(/^worldgen\\//, '').replaceAll('_', ' ')} ${file.name}: ${e.message}`\n\t\t\t\t\tthrow e\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\texport function groupProblems(...fixes: Fix[]): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\t// Mapping messages to a list of affected files\n\t\t\tconst problems: Record<string, string[]> = {}\n\t\t\tconst groupCtx = {\n\t\t\t\t...ctx,\n\t\t\t\twarn: (message: string, files?: string[]) => {\n\t\t\t\t\tif (files === undefined) {\n\t\t\t\t\t\tproblems[message] = []\n\t\t\t\t\t} else {\n\t\t\t\t\t\tfiles.forEach(file => {\n\t\t\t\t\t\t\t(problems[message] ??= []).push(file)\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t}\n\t\t\tawait Fix.all(...fixes)(pack, groupCtx)\n\t\t\tObject.entries(problems).forEach(([message, files]) =>\n\t\t\t\tctx.warn(message, [...new Set(files)]))\n\t\t}\n\t}\n\n\texport function when(key: keyof FixConfig, ...fixes: Fix[]): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tif (ctx.config(key)) {\n\t\t\t\tawait Fix.all(...fixes)(pack, ctx)\n\t\t\t}\n\t\t}\n\t}\n\n\texport function assert(predicate: (pack: Pack, ctx: FixContext) => boolean, message: string): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tif (!predicate(pack, ctx)) {\n\t\t\t\tthrow new Error(message)\n\t\t\t}\n\t\t}\n\t}\n\n\texport function version(from: Version, to: Version, ...fixes: Fix[]): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tif (Version.includes(ctx.source(), ctx.target(), from, to)) {\n\t\t\t\tawait Fix.all(...fixes)(pack, ctx)\n\t\t\t}\n\t\t}\n\t}\n\n\texport function versionInclusive(from: Version, to: Version, ...fixes: Fix[]): Fix {\n\t\treturn async (pack, ctx) => {\n\t\t\tif (Version.includesInclusive(ctx.source(), ctx.target(), from, to)) {\n\t\t\t\tawait Fix.all(...fixes)(pack, ctx)\n\t\t\t}\n\t\t}\n\t}\n\n\texport function debug(message: string): Fix {\n\t\treturn async () => {\n\t\t\tconsole.debug(message)\n\t\t}\n\t}\n}\n\nexport type FixConfig = {\n\tfunctions: boolean,\n\tids: boolean,\n\tpredicates: boolean,\n\tworldgen: boolean,\n\tpackFormat: boolean,\n\tfeatureCycles: boolean,\n}\n\nexport interface FixContext {\n\twarn: (message: string, files?: string[], info?: string[]) => unknown\n\tconfig: (key: keyof FixConfig) => boolean\n\tread: (category: string, name: string) => PackFile | undefined,\n\tcreate: (category: string, name: string, data: any) => unknown,\n\tsource: () => Version,\n\ttarget: () => Version,\n\tprompt: (title: string, prompt?: string, actions?: string[], info?: string[]) => Promise<string>,\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Adds the new config properties to configured carvers\n */\nexport const Carver = Fix.all(\n\tFix.onFile('worldgen/configured_carver', ({ data }) => fixCarver(data)),\n\tFix.onFile('worldgen/biome', ({ data }) => {\n\t\tif (typeof data.carvers === 'object') {\n\t\t\tdata.carvers.air?.forEach(fixCarver)\n\t\t\tdata.carvers.liquid?.forEach(fixCarver)\n\t\t}\n\t}),\n)\n\nfunction fixCarver(data: any) {\n\tif (typeof data !== 'object') return\n\tconst type = data.type.replace(/^minecraft:/, '')\n\n\tdata.config.lava_level = { above_bottom: 10 }\n\tdata.config.aquifers_enabled = false\n\tif (type === 'cave' || type === 'underwater_cave' || type === 'nether_cave') {\n\t\tif (type === 'nether_cave') {\n\t\t\tdata.config.y = {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tmin_inclusive: { absolute: 0 },\n\t\t\t\tmax_inclusive: { below_top: 1 },\n\t\t\t}\n\t\t} else {\n\t\t\tdata.config.y = {\n\t\t\t\ttype: 'minecraft:biased_to_bottom',\n\t\t\t\tmin_inclusive: { absolute: 0 },\n\t\t\t\tmax_inclusive: { absolute: 127 },\n\t\t\t\tinner: 8,\n\t\t\t}\n\t\t}\n\t\tdata.config.yScale = 0.5\n\t\tdata.config.horizontal_radius_multiplier = 1\n\t\tdata.config.vertical_radius_multiplier = 1\n\t\tdata.config.floor_level = -0.7\n\t} else {\n\t\tdata.config.y = {\n\t\t\ttype: 'minecraft:biased_to_bottom',\n\t\t\tmin_inclusive: { absolute: 20 },\n\t\t\tmax_inclusive: { absolute: 67 },\n\t\t\tinner: 8,\n\t\t}\n\t\tdata.config.yScale = 3\n\t\tdata.config.vertical_rotation = {\n\t\t\ttype: 'minecraft:uniform',\n\t\t\tvalue: { min_inclusive: -0.125, max_exclusive: 0.125 },\n\t\t}\n\t\tdata.config.shape = {\n\t\t\tdistance_factor: {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tvalue: { min_inclusive: 0.75, max_exclusive: 1 },\n\t\t\t},\n\t\t\tthickness: {\n\t\t\t\ttype: 'minecraft:trapezoid',\n\t\t\t\tvalue: { min: 0, max: 6, plateau: 2 },\n\t\t\t},\n\t\t\twidth_smoothness: 3,\n\t\t\thorizontal_radius_factor: {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tvalue: { min_inclusive: 0.75, max_exclusive: 1 },\n\t\t\t},\n\t\t\tvertical_radius_default_factor: 1,\n\t\t\tvertical_radius_center_factor: 0,\n\t\t}\n\t}\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Adds the \"min_y\" and \"height\" properties to dimension types\n */\nexport const DimensionType = Fix.all(\n\tFix.onFile('dimension_type', ({ data }) => fixDimensionType(data)),\n\tFix.onFile('dimension', ({ data }) => {\n\t\tif (typeof data.type === 'object') {\n\t\t\tfixDimensionType(data.type)\n\t\t}\n\t}),\n)\n\nfunction fixDimensionType(data: any) {\n\tdata.min_y = 0\n\tdata.height = 256\n}\n","import type { FixContext } from '../../Fix'\nimport { Fix } from '../../Fix'\n\nexport const Feature = Fix.all(\n\tFix.onFile('worldgen/configured_feature', ({ data }, ctx) => fixFeature(data, ctx)),\n\tFix.onFile('worldgen/biome', ({ data }) => {\n\t\tif (Array.isArray(data.starts)) {\n\t\t\tdata.starts.forEach(fixFeature)\n\t\t}\n\t}),\n)\n\nfunction fixFeature(data: any, ctx: FixContext) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'basalt_columns':\n\t\t\tfixUniformInt(data.config, 'reach')\n\t\t\tfixUniformInt(data.config, 'height')\n\t\t\tbreak\n\t\tcase 'decorated':\n\t\t\tfixDecorator(data.config.decorator, ctx)\n\t\t\tfixFeature(data.config.feature, ctx)\n\t\t\tbreak\n\t\tcase 'delta_feature':\n\t\t\tfixUniformInt(data.config, 'size')\n\t\t\tfixUniformInt(data.config, 'rim_size')\n\t\t\tbreak\n\t\tcase 'disk':\n\t\tcase 'ice_patch':\n\t\t\tfixUniformInt(data.config, 'radius')\n\t\t\tbreak\n\t\tcase 'emerald_ore':\n\t\t\tdata.type = 'minecraft:replace_single_block',\n\t\t\tdata.config = { targets: [ {\n\t\t\t\ttarget: {\n\t\t\t\t\tpredicate_type: 'minecraft:blockstate_match',\n\t\t\t\t\tblock_state: data.config.target,\n\t\t\t\t},\n\t\t\t\tstate: data.config.state,\n\t\t\t} ] }\n\t\t\tbreak\n\t\tcase 'flower':\n\t\tcase 'no_bonemeal_flower':\n\t\tcase 'random_patch':\n\t\t\tconst placer = data.config.block_placer\n\t\t\tif (placer.type.replace(/^minecraft:/, '') === 'column_placer') {\n\t\t\t\tplacer.size = {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tvalue: {\n\t\t\t\t\t\tmin_inclusive: placer.min_size,\n\t\t\t\t\t\tmax_inclusive: placer.min_size + placer.extra_size,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t\tdelete placer.min_size\n\t\t\t\tdelete placer.extra_size\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'fossil':\n\t\t\tdata.config = {\n\t\t\t\tmax_empty_corners_allowed: 4,\n\t\t\t\tfossil_processors: 'minecraft:fossil_rot',\n\t\t\t\toverlay_processors: 'minecraft:fossil_coal',\n\t\t\t\tfossil_structures: [\n\t\t\t\t\t'minecraft:fossil/spine_1',\n\t\t\t\t\t'minecraft:fossil/spine_2',\n\t\t\t\t\t'minecraft:fossil/spine_3',\n\t\t\t\t\t'minecraft:fossil/spine_4',\n\t\t\t\t\t'minecraft:fossil/skull_1',\n\t\t\t\t\t'minecraft:fossil/skull_2',\n\t\t\t\t\t'minecraft:fossil/skull_3',\n\t\t\t\t\t'minecraft:fossil/skull_4',\n\t\t\t\t],\n\t\t\t\toverlay_structures: [\n\t\t\t\t\t'minecraft:fossil/spine_1_coal',\n\t\t\t\t\t'minecraft:fossil/spine_2_coal',\n\t\t\t\t\t'minecraft:fossil/spine_3_coal',\n\t\t\t\t\t'minecraft:fossil/spine_4_coal',\n\t\t\t\t\t'minecraft:fossil/skull_1_coal',\n\t\t\t\t\t'minecraft:fossil/skull_2_coal',\n\t\t\t\t\t'minecraft:fossil/skull_3_coal',\n\t\t\t\t\t'minecraft:fossil/skull_4_coal',\n\t\t\t\t],\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'netherrack_replace_blobs':\n\t\t\tconst r = data.config.radius\n\t\t\tlet min = typeof r === 'number' ? r : r.base\n\t\t\tlet max = typeof r === 'number' ? r : r.base + r.spread\n\t\t\tif (max > 12) {\n\t\t\t\tctx.warn('Feature \"netherrack_replace_blobs\" no longer allows values above 12. Consider increasing the count of this feature.')\n\t\t\t\tmin = Math.min(12, min)\n\t\t\t\tmax = Math.min(12, max)\n\t\t\t}\n\t\t\tif (min === max) {\n\t\t\t\tdata.config.radius = min\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdata.config.radius = {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tvalue: {\n\t\t\t\t\tmin_inclusive: min,\n\t\t\t\t\tmax_inclusive: max,\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'no_surface_ore':\n\t\t\tfixOre(data)\n\t\t\tdata.type = 'minecraft:ore'\n\t\t\tdata.config.discard_chance_on_air_exposure = 1\n\t\t\tbreak\n\t\tcase 'ore':\n\t\t\tfixOre(data)\n\t\t\tbreak\n\t\tcase 'random_boolean_selector':\n\t\t\tfixFeature(data.config.feature_false, ctx)\n\t\t\tfixFeature(data.config.feature_true, ctx)\n\t\t\tbreak\n\t\tcase 'random_selector':\n\t\t\tdata.config.features.forEach((e: any) => fixFeature(e.feature, ctx))\n\t\t\tfixFeature(data.config.default, ctx)\n\t\t\tbreak\n\t\tcase 'sea_pickle':\n\t\t\tfixUniformInt(data.config, 'count')\n\t\t\tbreak\n\t\tcase 'simple_block':\n\t\t\tdata.config.to_place = {\n\t\t\t\ttype: 'minecraft:simple_state_provider',\n\t\t\t\tstate: data.config.to_place,\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'simple_random_selector':\n\t\t\tdata.config.features.forEach((feature: any) => fixFeature(feature, ctx))\n\t\t\tbreak\n\t\tcase 'tree':\n\t\t\t['radius', 'offset', 'crown_height', 'height', 'trunk_height']\n\t\t\t\t.forEach(k => fixUniformInt(data.config.foliage_placer, k))\n\t\t\tdata.config.foliage_provider = data.config.leaves_provider\n\t\t\tdelete data.config.leaves_provider\n\t\t\tdata.config.force_dirt = false\n\t\t\tdata.config.dirt_provider = {\n\t\t\t\ttype: 'minecraft:simple_state_provider',\n\t\t\t\tstate: {\n\t\t\t\t\tName: 'minecraft:dirt',\n\t\t\t\t},\n\t\t\t}\n\t\t\tdata.config.sapling_provider = {\n\t\t\t\ttype: 'minecraft:simple_state_provider',\n\t\t\t\tstate: {\n\t\t\t\t\tName: getSapling(data.config.foliage_provider),\n\t\t\t\t\tProperties: {\n\t\t\t\t\t\tstage: '0',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = {\n\t\t\t\tdecorator: {\n\t\t\t\t\ttype: 'decorated',\n\t\t\t\t\tconfig: combinedDecorators(\n\t\t\t\t\t\t{ type: 'minecraft:water_depth_threshold', config: {\n\t\t\t\t\t\t\tmax_water_depth: data.config.max_water_depth,\n\t\t\t\t\t\t} },\n\t\t\t\t\t\t{ type: 'minecraft:heightmap', config: {\n\t\t\t\t\t\t\theightmap: data.config.heightmap,\n\t\t\t\t\t\t} }\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t\tfeature: {\n\t\t\t\t\ttype: 'minecraft:tree',\n\t\t\t\t\tconfig: data.config,\n\t\t\t\t},\n\t\t\t}\n\t\t\tdelete data.config.feature.config.max_water_depth\n\t\t\tdelete data.config.feature.config.heightmap\n\t\t\tbreak\n\t}\n}\n\nfunction fixUniformInt(data: any, key: string) {\n\tif (typeof data?.[key] === 'object') {\n\t\tdata[key] = {\n\t\t\ttype: 'minecraft:uniform',\n\t\t\tvalue: {\n\t\t\t\tmin_inclusive: data[key].base,\n\t\t\t\tmax_inclusive: data[key].base + data[key].spread,\n\t\t\t},\n\t\t}\n\t}\n}\n\nfunction fixOre(data: any) {\n\tdata.config.discard_chance_on_air_exposure = 0\n\tdata.config.targets = [{\n\t\ttarget: data.config.target,\n\t\tstate: data.config.state,\n\t}]\n\tdelete data.config.target\n\tdelete data.config.state\n}\n\nfunction getSapling(foliage: any) {\n\tif (foliage.type.replace(/^minecraft:/, '') === 'simple_state_provider') {\n\t\tconst match = foliage.state.Name.match(/^(?:minecraft:)?([a-z_]+)_leaves/)\n\t\tif (match) {\n\t\t\treturn `minecraft:${match[1]}_sapling`\n\t\t}\n\t}\n\treturn 'minecraft:oak_sapling'\n}\n\nfunction fixDecorator(data: any, ctx: FixContext) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'carving_mask':\n\t\t\tif (data.config.probability === 0) {\n\t\t\t\tdata.type = 'minecraft:nope'\n\t\t\t\tdata.config = {}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tconst chance = 1 / data.config.probability\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:carving_mask', config: { step: data.config.step } },\n\t\t\t\t...Number.isInteger(chance) ? [\n\t\t\t\t\t{ type: 'minecraft:chance', config: { chance: chance } },\n\t\t\t\t] : [\n\t\t\t\t\t{ type: 'minecraft:count_extra', config: {\n\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\textra_count: 1,\n\t\t\t\t\t\textra_chance: data.config.probability,\n\t\t\t\t\t} },\n\t\t\t\t]\n\t\t\t)\n\t\t\tdelete data.config.probability\n\t\t\tbreak\n\t\tcase 'count':\n\t\tcase 'count_multilayer':\n\t\t\tconst c = data.config.count\n\t\t\tlet min0 = typeof c === 'number' ? c : c.base\n\t\t\tlet max0 = typeof c === 'number' ? c : c.base + c.spread\n\t\t\tif (min0 < 0) {\n\t\t\t\tctx.warn(`Decorator \"${type}\" no longer allows negative values.`)\n\t\t\t\tmin0 = Math.max(0, min0)\n\t\t\t\tmax0 = Math.max(0, max0)\n\t\t\t}\n\t\t\tif (min0 === max0) {\n\t\t\t\tdata.config.count = min0\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdata.config.count = {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tvalue: {\n\t\t\t\t\tmin_inclusive: min0,\n\t\t\t\t\tmax_inclusive: max0,\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'decorated':\n\t\t\tfixDecorator(data.config.outer, ctx)\n\t\t\tfixDecorator(data.config.inner, ctx)\n\t\t\tbreak\n\t\tcase 'heightmap_world_surface':\n\t\t\tdata.type = 'minecraft:heightmap'\n\t\t\tdata.config = { heightmap: 'WORLD_SURFACE_WG' }\n\t\t\tbreak\n\t\tcase 'top_solid_heightmap':\n\t\t\tdata.type = 'minecraft:heightmap'\n\t\t\tdata.config = { heightmap: 'OCEAN_FLOOR_WG' }\n\t\t\tbreak\n\t\tcase 'heightmap':\n\t\tcase 'heightmap_spread_double':\n\t\t\tdata.config = { heightmap: 'MOTION_BLOCKING' }\n\t\t\tbreak\n\t\tcase 'water_lake':\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:chance', config: { chance: data.config.chance } },\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:biased_to_bottom',\n\t\t\t\t\tmin_inclusive: { absolute: 0 },\n\t\t\t\t\tmax_inclusive: { absolute: 256 },\n\t\t\t\t\tinner: 8,\n\t\t\t\t} } }\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'lava_lake':\n\t\t\tconst chance2 = data.config.chance / 10\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t...Number.isInteger(chance2) ? [\n\t\t\t\t\t{ type: 'minecraft:chance', config: { chance: chance2 } },\n\t\t\t\t] : [\n\t\t\t\t\t{ type: 'minecraft:count_extra', config: {\n\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\textra_count: 1,\n\t\t\t\t\t\textra_chance: 1 / chance2,\n\t\t\t\t\t} },\n\t\t\t\t],\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:biased_to_bottom',\n\t\t\t\t\tmin_inclusive: { absolute: 0 },\n\t\t\t\t\tmax_inclusive: { absolute: 256 },\n\t\t\t\t\tinner: 8,\n\t\t\t\t} } },\n\t\t\t\t{ type: 'minecraft:lava_lake', config: { chance: 10 } },\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'fire':\n\t\t\tconst count = typeof data.config.count === 'number' ? data.config.count : data.config.count.base + data.config.count.spread / 2\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:count', config: { count: {\n\t\t\t\t\ttype: 'minecraft:biased_to_bottom', value: {\n\t\t\t\t\t\tmin_inclusive: 0,\n\t\t\t\t\t\tmax_inclusive: Math.ceil(count / 2),\n\t\t\t\t\t},\n\t\t\t\t} } },\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tmin_inclusive: { absolute: 4 },\n\t\t\t\t\tmax_inclusive: { absolute: 252 },\n\t\t\t\t} } },\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'glowstone':\n\t\t\tconst count2 = typeof data.config.count === 'number' ? data.config.count : data.config.count.base + data.config.count.spread / 2\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:count', config: { count: {\n\t\t\t\t\ttype: 'minecraft:biased_to_bottom', value: {\n\t\t\t\t\t\tmin_inclusive: 0,\n\t\t\t\t\t\tmax_inclusive: Math.ceil(count2 - 1),\n\t\t\t\t\t},\n\t\t\t\t} } },\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tmin_inclusive: { absolute: 4 },\n\t\t\t\t\tmax_inclusive: { absolute: 252 },\n\t\t\t\t} } },\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'range':\n\t\t\tconst min = data.config.bottom_offset\n\t\t\tconst max = data.config.bottom_offset + data.config.maximum - data.config.top_offset - 1\n\t\t\tif (min === max) {\n\t\t\t\tdata.config = {\n\t\t\t\t\theight: { absolute: min },\n\t\t\t\t}\n\t\t\t\tbreak\n\t\t\t}\n\t\t\tdata.config = {\n\t\t\t\theight: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tmin_inclusive: { absolute: min },\n\t\t\t\t\tmax_inclusive: { absolute: max },\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'range_biased':\n\t\t\tconst min2 = data.config.bottom_offset\n\t\t\tconst max2 = data.config.bottom_offset + data.config.maximum - data.config.top_offset - 1\n\t\t\tdata.type = 'minecraft:range'\n\t\t\tdata.config = {\n\t\t\t\theight: {\n\t\t\t\t\ttype: 'minecraft:biased_to_bottom',\n\t\t\t\t\tmin_inclusive: { absolute: min2 },\n\t\t\t\t\tmax_inclusive: { absolute: max2 },\n\t\t\t\t\tcutoff: min2,\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'range_very_biased':\n\t\t\tconst min3 = data.config.bottom_offset\n\t\t\tconst max3 = data.config.bottom_offset + data.config.maximum - data.config.top_offset - 1\n\t\t\tdata.type = 'minecraft:range'\n\t\t\tdata.config = {\n\t\t\t\theight: {\n\t\t\t\t\ttype: 'minecraft:very_biased_to_bottom',\n\t\t\t\t\tmin_inclusive: { absolute: min3 },\n\t\t\t\t\tmax_inclusive: { absolute: max3 },\n\t\t\t\t\tcutoff: min3,\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'depth_average':\n\t\t\tdata.type = 'minecraft:range'\n\t\t\tdata.config = {\n\t\t\t\theight: {\n\t\t\t\t\ttype: 'minecraft:trapezoid',\n\t\t\t\t\tmin_inclusive: { absolute: data.config.baseline },\n\t\t\t\t\tmax_inclusive: { absolute: data.config.baseline + data.config.spread },\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'emerald_ore':\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:count', config: { count: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tvalue: { min_inclusive: 3, max_inclusive: 8 },\n\t\t\t\t} } },\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tmin_inclusive: { absolute: 4 },\n\t\t\t\t\tmax_inclusive: { absolute: 31 },\n\t\t\t\t} } }\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'end_island':\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = combinedDecorators(\n\t\t\t\t{ type: 'minecraft:chance', config: { chance: 14 } },\n\t\t\t\t{ type: 'minecraft:count_extra', config: {\n\t\t\t\t\tcount: 1,\n\t\t\t\t\textra_count: 1,\n\t\t\t\t\textra_chance: 0.25,\n\t\t\t\t} },\n\t\t\t\t{ type: 'minecraft:square', config: {} },\n\t\t\t\t{ type: 'minecraft:range', config: { height: {\n\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\tmin_inclusive: { absolute: 55 },\n\t\t\t\t\tmax_inclusive: { absolute: 70 },\n\t\t\t\t} } }\n\t\t\t)\n\t\t\tbreak\n\t\tcase 'magma':\n\t\t\tctx.warn('Removed decorator \"magma\" previously used the sea level. Assumed sea level is 32 and replaced with a range decorator between 27 and 36.')\n\t\t\tdata.type = 'minecraft:range'\n\t\t\tdata.config = { height: {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tmin_inclusive: { absolute: 27 },\n\t\t\t\tmax_inclusive: { absolute: 36 },\n\t\t\t} }\n\t\t\tbreak\n\t}\n}\n\nfunction combinedDecorators(...decorators: any[]): any {\n\treturn {\n\t\touter: decorators[0],\n\t\tinner: decorators.length === 2 ? decorators[1] : {\n\t\t\ttype: 'minecraft:decorated',\n\t\t\tconfig: combinedDecorators(...decorators.slice(1)),\n\t\t},\n\t}\n}\n","import { Fix } from '../../Fix'\n\nconst replaceitemRegex = /replaceitem ((?:entity @[parse](\\[.*\\]*)?|block( [^ ]+){3}) [a-z0-9.]+) /\nconst timeObjectiveRegex = /scoreboard objectives add ([^ ]+) (minecraft.)?custom:(minecraft.)?play_one_minute/\n\n/**\n * Upgrades /replaceitem to /item replace ... with\n */\nexport const Function = Fix.onFile('functions', ({ data }: { data: string[] }) => {\n\tdata.forEach((line, i) => {\n\t\tif (line.startsWith('replaceitem ') || line.startsWith('execute ')) {\n\t\t\tdata[i] = data[i].replace(replaceitemRegex, 'item replace $1 with ')\n\t\t}\n\t\tif (line.startsWith('scoreboard') || line.startsWith('execute')) {\n\t\t\tdata[i] = data[i].replace(timeObjectiveRegex, 'scoreboard objectives add $1 $2custom:$3play_time')\n\t\t}\n\t})\n})\n","import { Fix } from '../../Fix'\n\n/**\n * Renames grass_path to dirt_path\n */\nexport const Ids = Fix.all(\n\tFix.onFile('tags/blocks', ({ data }) => fixTag(data)),\n\tFix.onFile('tags/items', ({ data }) => fixTag(data)),\n)\n\nfunction fixTag(data: any) {\n\tdata.values?.forEach((_: any, i: number) => fixIds(data.values, i))\n}\n\nexport function fixIds(data: any, key: string | number) {\n\tconst id = data[key].replace(/^minecraft:/, '')\n\n\tif (id === 'grass_path') {\n\t\tdata[key] = 'minecraft:dirt_path'\n\t}\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Adds the \"min_y\" and \"height\" properties to dimension types\n */\nexport const NoiseSettings = Fix.all(\n\tFix.onFile('worldgen/noise_settings', ({ data }) => fixNoiseSettings(data)),\n\tFix.onFile('dimension', ({ data }) => {\n\t\tif (data.generator?.type?.replace(/^minecraft:/, '') === 'noise') {\n\t\t\tfixNoiseSettings(data.generator.settings)\n\t\t}\n\t}),\n)\n\nfunction fixNoiseSettings(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (data.bedrock_roof_position <= -10) data.bedrock_roof_position = -2147483648\n\tif (data.bedrock_floor_position <= -10) data.bedrock_floor_position = -2147483648\n\n\tdata.min_surface_level = 0\n\tdata.noise_caves_enabled = false\n\tdata.noodle_caves_enabled = false\n\tdata.aquifers_enabled = false\n\tdata.deepslate_enabled = false\n\tdata.ore_veins_enabled = false\n\tdata.noise.min_y = 0\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Fixes item and block predicates all over predicates, advancements and loot tables\n */\nexport const Predicates = Fix.all(\n\tFix.onFile('predicates', ({ data }) => {\n\t\tif (Array.isArray(data)) {\n\t\t\tdata.forEach(fixCondition)\n\t\t} else {\n\t\t\tfixCondition(data)\n\t\t}\n\t}),\n\tFix.onFile('advancements', ({ data }) => {\n\t\tObject.values(data.criteria).forEach(fixCriterion)\n\t}),\n\tFix.onFile('loot_tables', ({ data }) => {\n\t\tdata.pools?.forEach(fixPool)\n\t}),\n)\n\nfunction fixCriterion(data: any) {\n\tif (typeof data.conditions !== 'object') return\n\n\tfixEntity(data.conditions.entity)\n\tfixEntity(data.conditions.player)\n\tfixEntity(data.conditions.parent)\n\tfixEntity(data.conditions.partner)\n\tfixEntity(data.conditions.child)\n\tfixEntity(data.conditions.villager)\n\tfixEntity(data.conditions.zombie)\n\tfixEntity(data.conditions.projectile)\n\tfixEntity(data.conditions.shooter)\n\tdata.conditions.victims?.forEach(fixEntity)\n\n\tfixItem(data.conditions.item)\n\tdata.conditions.items?.forEach(fixItem)\n\n\tfixDamage(data.conditions.damage)\n\tfixDamage(data.conditions.killing_blow)\n\t\n\tfixLocation(data.conditions.location)\n\tfixLocation(data.conditions.entered)\n\tfixLocation(data.conditions.exited)\n}\n\nfunction fixPool(data: any) {\n\tdata.entries?.forEach(fixEntry)\n\tdata.conditions?.forEach(fixCondition)\n}\n\nfunction fixEntry(data: any) {\n\tdata.children?.forEach(fixEntry)\n\tdata.conditions?.forEach(fixCondition)\n}\n\nfunction fixCondition(data: any) {\n\tconst condition = data.condition.replace(/^minecraft:/, '')\n\tswitch (condition) {\n\t\tcase 'match_tool':\n\t\t\tfixItem(data.predicate)\n\t\t\tbreak\n\t\tcase 'entity_properties':\n\t\t\tfixEntity(data.predicate)\n\t\t\tbreak\n\t\tcase 'damage_source_properties':\n\t\t\tfixDamage(data.predicate)\n\t\t\tbreak\n\t\tcase 'location_check':\n\t\t\tfixLocation(data.predicate)\n\t\t\tbreak\n\t}\n}\n\nfunction fixDamage(data: any) {\n\tif (typeof data !== 'object') return\n\n\tfixEntity(data.source_entity)\n\tfixEntity(data.direct_entity)\n\tfixDamage(data.type)\n}\n\nfunction fixEntity(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (Array.isArray(data)) {\n\t\tdata.forEach(fixCondition)\n\t\treturn\n\t}\n\n\tif (data.equipment) {\n\t\tObject.values(data.equipment).forEach(fixItem)\n\t}\n\tfixEntity(data.vehicle)\n\tfixEntity(data.targeted_entity)\n\tfixLocation(data.location)\n}\n\nfunction fixLocation(data: any) {\n\tif (typeof data !== 'object') return\n\n\tfixBlock(data.block)\n}\n\nfunction fixItem(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (data.item) {\n\t\tdata.items = [data.item]\n\t\tdelete data.item\n\t}\n}\n\nfunction fixBlock(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (data.block) {\n\t\tdata.blocks = [data.block]\n\t\tdelete data.block\n\t}\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Adds the new config property to the nether_fossil structure feature\n */\nexport const StructureFeature = Fix.all(\n\tFix.onFile('worldgen/configured_structure_feature', ({ data }) => fixStructureFeature(data)),\n\tFix.onFile('worldgen/biome', ({ data }) => {\n\t\tif (Array.isArray(data.starts)) {\n\t\t\tdata.starts.forEach(fixStructureFeature)\n\t\t}\n\t}),\n)\n\nfunction fixStructureFeature(data: any) {\n\tif (typeof data !== 'object') return\n\tconst type = data.type.replace(/^minecraft:/, '')\n\n\tif (type === 'nether_fossil') {\n\t\tif (!data.config) data.config = {}\n\t\tdata.config.height = {\n\t\t\ttype: 'minecraft:uniform',\n\t\t\tmin_inclusive: { absolute: 32 },\n\t\t\tmax_inclusive: { below_top: 2 },\n\t\t}\n\t}\n}\n","import { Fix } from '../../Fix'\nimport { Carver } from './Carver'\nimport { DimensionType } from './DimensionType'\nimport { Feature } from './Feature'\nimport { Function } from './Function'\nimport { Ids } from './Ids'\nimport { NoiseSettings } from './NoiseSettings'\nimport { Predicates } from './Predicates'\nimport { StructureFeature } from './StructureFeature'\n\nexport const Fixes17 = Fix.version('1.16.5', '1.17.1', Fix.groupProblems(\n\tFix.debug('1.17 fixes'),\n\tFix.assert(pack => pack.meta.data.pack.pack_format < 7, 'This pack already has pack_format 7 or higher and cannot be upgraded.'),\n\tFix.when('ids', Ids),\n\tFix.when('predicates', Predicates),\n\tFix.when('functions', Function),\n\tFix.when('worldgen',\n\t\tDimensionType,\n\t\tNoiseSettings,\n\t\tStructureFeature,\n\t\tCarver,\n\t\tFeature\n\t),\n\tFix.when('packFormat', async pack => pack.meta.data.pack.pack_format = 7),\n))\n","import type { FixContext } from '../../Fix'\nimport { Fix } from '../../Fix'\nimport type { PackFile } from '../../Pack'\n\nexport const Feature = Fix.all(\n\tFix.onFile('worldgen/configured_feature', fixRootFeature),\n\n\t// Remove or rename vanilla configured features and carvers\n\tFix.onFile('worldgen/biome', ({ data }, ctx) => {\n\t\tdata.player_spawn_friendly = undefined\n\n\t\t;['air', 'liquid'].forEach(step => {\n\t\t\tif (Array.isArray(data.carvers[step])) {\n\t\t\t\tdata.carvers[step] = data.carvers[step].filter((c: any) => !CarverRemovals.has(c.replace(/^minecraft:/, '')))\n\t\t\t}\n\t\t})\n\n\t\tif (!Array.isArray(data.features)) return\n\t\tdata.features = data.features.map((d: any) => {\n\t\t\tif (!Array.isArray(d)) return d\n\t\t\treturn d.flatMap(e => {\n\t\t\t\tif (typeof e !== 'string') return e\n\t\t\t\tconst replacement = fixFeatureId(e, ctx)\n\t\t\t\treplacement.forEach(r => {\n\t\t\t\t\tconst file = ctx.read('worldgen/placed_feature', r)\n\t\t\t\t\tif (!file) return\n\t\t\t\t\tif (file.data.placement.find((p: any) => p.type === 'minecraft:biome')) return\n\t\t\t\t\tfile.data.placement.push({ type: 'minecraft:biome' })\n\t\t\t\t})\n\t\t\t\treturn replacement\n\t\t\t})\n\t\t})\n\t}),\n)\n\nfunction fixFeatureId(str: string, ctx: FixContext) {\n\tconst id = str.replace(/^minecraft:/, '')\n\tif (FeatureReplacements.has(id)) {\n\t\treturn FeatureReplacements.get(id)!.map(e => `minecraft:${e}`)\n\t} else if (FeatureRenames.has(id) || FeatureRenamesPlacement.has(id)) {\n\t\treturn [`minecraft:${FeatureRenames.get(id) ?? FeatureRenamesPlacement.get(id)}`]\n\t} else if (FeatureOnlyConfig.has(id) && ctx.read('worldgen/placed_feature', id) === undefined) {\n\t\treturn []\n\t} else if (FeatureFullyRemoved.has(id)) {\n\t\treturn []\n\t} else {\n\t\treturn [str]\n\t}\n}\n\nfunction fixRootFeature(file: PackFile, ctx: FixContext) {\n\tif (typeof file.data !== 'object') return\n\n\tconst f = fixFeature(file.data, ctx)\n\tif (typeof f.feature === 'string') {\n\t\tfile.data = redirect(fixPlacedFeatureId(f.feature, ctx))\n\t} else {\n\t\tfile.data = {\n\t\t\ttype: f?.feature.type,\n\t\t\tconfig: f?.feature.config,\n\t\t}\n\t\tf.feature = file.name\n\t}\n\tctx.create('worldgen/placed_feature', file.name, {\n\t\tfeature: f.feature,\n\t\tplacement: f?.placement,\n\t})\n}\n\n// Wraps a placed feature in a configured feature\nfunction redirect(placedFeature: unknown) {\n\treturn {\n\t\ttype: 'minecraft:random_selector',\n\t\tconfig: {\n\t\t\tfeatures: [],\n\t\t\tdefault: placedFeature,\n\t\t},\n\t}\n}\n\n/**\n * Fixes a configured feature into a placed feature\n */\nfunction fixFeature(data: any, ctx: FixContext) {\n\tif (typeof data === 'string') {\n\t\tconst id = data.replace(/^minecraft:/, '')\n\t\tif (FeatureFullyRemoved.has(id)) {\n\t\t\tdata = { type: 'minecraft:no_op', config: {} }\n\t\t} else if (FeatureOnlyPlacement.has(id)) {\n\t\t\tdata = redirect(data)\n\t\t} else if (FeatureRenames.has(id) || FeatureRenamesConfig.has(id)) {\n\t\t\tconst configuredFeature = FeatureRenamesConfig.get(id) ?? FeatureRenames.get(id)\n\t\t\tconsole.log(`Rename ${id} -> configured: ${configuredFeature}`)\n\t\t\tdata = `minecraft:${configuredFeature}`\n\t\t} else if (FeatureRenamesPlacement.has(id)) {\n\t\t\tconst placedFeature = FeatureRenamesPlacement.get(id)\n\t\t\tconsole.log(`Redirect ${id} -> placed: ${placedFeature}`)\n\t\t\tdata = redirect(placedFeature)\n\t\t}\n\t\treturn {\n\t\t\tfeature: data,\n\t\t\tplacement: [],\n\t\t}\n\t}\n\n\tif (typeof data !== 'object') throw new Error('Feature is not an object nor a string')\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tconst placement: any[] = []\n\tswitch (type) {\n\t\tcase 'decorated':\n\t\t\tconst feature = collectDecorators(data, placement, ctx)\n\t\t\tdata = fixToConfiguredFeature(feature, ctx)\n\t\t\tbreak\n\t\tcase 'glow_lichen':\n\t\t\tdata.config.can_be_placed_on = [...new Set(\n\t\t\t\tdata.config.can_be_placed_on.map((b: any) => b.Name)\n\t\t\t)]\n\t\t\tbreak\n\t\tcase 'lake':\n\t\t\tdata.config = {\n\t\t\t\tfluid: {\n\t\t\t\t\ttype: 'minecraft:simple_state_provider',\n\t\t\t\t\tstate: data.config.state,\n\t\t\t\t},\n\t\t\t\tbarrier: {\n\t\t\t\t\ttype: 'minecraft:simple_state_provider',\n\t\t\t\t\tstate: {\n\t\t\t\t\t\tName: 'minecraft:stone',\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'nether_forest_vegetation':\n\t\t\tdata.config.spread_width = 8\n\t\t\tdata.config.spread_height = 4\n\t\t\tbreak\n\t\tcase 'random_boolean_selector':\n\t\t\tdata.config.feature_false = fixToPlacedFeature(data.config.feature_false, ctx)\n\t\t\tdata.config.feature_true = fixToPlacedFeature(data.config.feature_true, ctx)\n\t\t\tbreak\n\t\tcase 'root_system':\n\t\t\tdata.config.allowed_tree_position = { type: 'minecraft:true' }\n\t\t// eslint-disable-next-line no-fallthrough\n\t\tcase 'random_patch':\n\t\tcase 'flower':\n\t\tcase 'no_bonemeal_flower':\n\t\t\tdata.config.feature = fixToPlacedFeature(data.config.feature, ctx)\n\t\t\tbreak\n\t\tcase 'random_selector':\n\t\t\tdata.config.features.forEach((e: any) => {\n\t\t\t\te.feature = fixToPlacedFeature(e.feature, ctx)\n\t\t\t})\n\t\t\tdata.config.default = fixToPlacedFeature(data.config.default, ctx)\n\t\t\tbreak\n\t\tcase 'simple_random_selector':\n\t\t\tdata.config.features = data.config.features.map((f: any) => {\n\t\t\t\treturn fixToPlacedFeature(f, ctx)\n\t\t\t})\n\t\t\tbreak\n\t\tcase 'twisting_vines':\n\t\t\tdata.config = {\n\t\t\t\tspread_width: 8,\n\t\t\t\tspread_height: 4,\n\t\t\t\tmax_height: 8,\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'vegetation_patch':\n\t\tcase 'waterlogged_vegetation_patch':\n\t\t\tdata.config.vegetation_feature = fixToPlacedFeature(data.config.vegetation_feature, ctx)\n\t}\n\treturn {\n\t\tfeature: data,\n\t\tplacement,\n\t}\n}\n\n/**\n * Fixes a configured feature and then returns it as a reference to a placed feature\n */\nfunction fixToPlacedFeature(data: any, ctx: FixContext) {\n\tconst f = fixFeature(data, ctx)\n\tif (typeof f.feature === 'string' && f.placement.length === 0) {\n\t\treturn fixPlacedFeatureId(f.feature, ctx)\n\t}\n\treturn f\n}\n\nfunction fixPlacedFeatureId(feature: string, ctx: FixContext) {\n\tconst id = feature.replace(/^minecraft:/, '')\n\tif (FeatureRenames.has(id) || FeatureRenamesPlacement.has(id)) {\n\t\tconst placedFeature = FeatureRenamesPlacement.get(id) ?? FeatureRenames.get(id)\n\t\tconsole.log(`Rename placement: ${id} -> ${placedFeature}`)\n\t\treturn `minecraft:${placedFeature}`\n\t}\n\tif (!FeatureOnlyConfig.has(id) && ctx.read('worldgen/configured_feature', id) === undefined) {\n\t\tconsole.log(`No placement: ${id}`)\n\t\treturn feature\n\t}\n\treturn {\n\t\tfeature,\n\t\tplacement: [],\n\t}\n}\n\n/**\n * Fixes a configured feature and then returns it as a reference to a configured feature\n */\nfunction fixToConfiguredFeature(data: any, ctx: FixContext) {\n\tconst f = fixFeature(data, ctx)\n\tif (typeof f.feature === 'string' && f.placement.length === 0) {\n\t\tconst id = f.feature.replace(/^minecraft:/, '')\n\t\tif (FeatureRenames.has(id) || FeatureRenamesConfig.has(id)) {\n\t\t\tconst configuredFeature = FeatureRenamesConfig.get(id) ?? FeatureRenames.get(id)\n\t\t\tconsole.log(`Rename config: ${id} -> ${configuredFeature}`)\n\t\t\treturn `minecraft:${configuredFeature}`\n\t\t}\n\t\tif (FeatureOnlyPlacement.has(id)) {\n\t\t\treturn redirect(f.feature)\n\t\t}\n\t}\n\treturn f.feature\n}\n\n/**\n * Converts a configured decorator to a list of placement modifiers\n */\nfunction fixDecorator(data: any, ctx: FixContext): any[] {\n\tif (typeof data !== 'object') return []\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'block_filter':\n\t\t\treturn [{ type: 'minecraft:block_predicate_filter', ...data.config }]\n\t\tcase 'cave_surface':\n\t\t\tconst steps = data.config.floor_to_ceiling_search_range\n\t\t\tif (steps > 32) {\n\t\t\t\tctx.warn('Converting cave_surface decorator into environment_scan: \"max_steps\" is limited to 32.')\n\t\t\t}\n\t\t\tconst config = {\n\t\t\t\tdirection_of_search: data.config.surface === 'ceiling' ? 'up' : 'down',\n\t\t\t\ttarget_condition: {\n\t\t\t\t\ttype: 'minecraft:solid',\n\t\t\t\t},\n\t\t\t\tallowed_search_condition: {\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\tblocks: [\n\t\t\t\t\t\t'minecraft:air',\n\t\t\t\t\t\t...data.config.allow_water ? ['minecraft:water'] : [],\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t\tmax_steps: Math.min(32, steps),\n\t\t\t}\n\t\t\treturn [{ type: 'minecraft:environment_scan', ...config }]\n\t\tcase 'count_multilayer':\n\t\t\treturn [{ type: 'minecraft:count_on_every_layer', ...data.config }]\n\t\tcase 'chance':\n\t\t\treturn [{ type: 'minecraft:rarity_filter', ...data.config }]\n\t\tcase 'count_extra':\n\t\t\tlet max = data.config.count + data.config.extra_count\n\t\t\tif (max > 256) {\n\t\t\t\tlet factors = [max]\n\t\t\t\tmax -= 1\n\t\t\t\twhile (factors.some(f => f > 256)) {\n\t\t\t\t\tmax += 1\n\t\t\t\t\tfactors = primeFactors(max)\n\t\t\t\t}\n\n\t\t\t\tfor (let n = 2; n <= 5; n += 1) {\n\t\t\t\t\tconst counts: number[] = Array(n).fill(1)\n\t\t\t\t\tconst factorsToUse = [...factors]\n\t\t\t\t\touter:\n\t\t\t\t\twhile (factorsToUse.length > 0) {\n\t\t\t\t\t\tconst f = factorsToUse.pop()\n\t\t\t\t\t\tfor (let i = 0; i < n; i += 1) {\n\t\t\t\t\t\t\tif (counts[i] * f <= 256) {\n\t\t\t\t\t\t\t\tcounts[i] *= f\n\t\t\t\t\t\t\t\tcontinue outer\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t\tif (factorsToUse.length === 0 && counts.every(p => p <= 256)) {\n\t\t\t\t\t\treturn counts.map(count => ({ type: 'minecraft:count', count }))\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tthrow new Error(`Extremely high count: ${data.config.count + data.config.extra_count}`)\n\t\t\t}\n\t\t\tconst count = {\n\t\t\t\ttype: 'minecraft:weighted_list',\n\t\t\t\tdistribution: [\n\t\t\t\t\t{\n\t\t\t\t\t\tweight: Math.round(100 * (1 - data.config.extra_chance)),\n\t\t\t\t\t\tdata: Math.min(256, data.config.count),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tweight: Math.round(100 * data.config.extra_chance),\n\t\t\t\t\t\tdata: Math.min(256, max),\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}\n\t\t\treturn [{ type: 'minecraft:count', count }]\n\t\tcase 'count_noise':\n\t\t\treturn [{ type: 'minecraft:noise_threshold_count', ...data.config }]\n\t\tcase 'count_noise_biased':\n\t\t\treturn [{ type: 'minecraft:noise_based_count', ...data.config }]\n\t\tcase 'dark_oak_tree':\n\t\t\treturn [{ type: 'minecraft:count', count: 16 }, { type: 'minecraft:in_square' }]\n\t\tcase 'decorated':\n\t\t\tconst outer = fixDecorator(data.config.outer, ctx)\n\t\t\tconst inner = fixDecorator(data.config.inner, ctx)\n\t\t\treturn [...outer, ...inner]\n\t\tcase 'end_gateway':\n\t\t\tconst y_spread = {\n\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\tvalue: {\n\t\t\t\t\tmin_inclusive: 3,\n\t\t\t\t\tmax_inclusive: 9,\n\t\t\t\t},\n\t\t\t}\n\t\t\treturn [{ type: 'minecraft:random_offset', xz_spread: 0, y_spread }]\n\t\tcase 'iceberg':\n\t\t\treturn [{ type: 'minecraft:in_square' }]\n\t\tcase 'lava_lake':\n\t\t\treturn [{ type: 'minecraft:rarity_filter', chance: 10 }]\n\t\tcase 'nope':\n\t\t\treturn []\n\t\tcase 'range':\n\t\t\treturn [{ type: 'minecraft:height_range', ...data.config }]\n\t\tcase 'scatter':\n\t\t\treturn [{ type: 'minecraft:random_offset', ...data.config }]\n\t\tcase 'square':\n\t\t\treturn [{ type: 'minecraft:in_square', ...data.config }]\n\t\tcase 'surface_relative_threshold':\n\t\t\treturn [{ type: 'minecraft:surface_relative_threshold_filter', ...data.config }]\n\t\tcase 'water_depth_threshold':\n\t\t\treturn [{ type: 'minecraft:surface_water_depth_filter', ...data.config }]\n\t\tdefault:\n\t\t\treturn [{ type, ...data.config }]\n\t}\n}\n\nfunction collectDecorators(data: any, placement: any[], ctx: FixContext): any {\n\tif (typeof data !== 'object') return data\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tif (type === 'decorated') {\n\t\tplacement.push(...fixDecorator(data.config.decorator, ctx))\n\t\treturn collectDecorators(data.config.feature, placement, ctx)\n\t}\n\treturn data\n}\n\nfunction primeFactors(n: number) {\n\tconst factors = []\n\tlet divisor = 2\n\twhile (n >= 2) {\n\t\tif (n % divisor == 0) {\n\t\t\tfactors.push(divisor)\n\t\t\tn = n / divisor\n\t\t} else {\n\t\t\tdivisor += 1\n\t\t}\n\t}\n\treturn factors\n}\n\n// Configured features in 1.17 that were replaced with multiple placed features\nconst FeatureReplacements = new Map(Object.entries({\n\tbirch_other: ['forest_flowers', 'trees_birch_and_oak'],\n\tfossil: ['fossil_upper', 'fossil_lower'],\n\tlake_lava: ['lake_lava_surface', 'lake_lava_underground'],\n\tmonster_room: ['monster_room', 'monster_room_deep'],\n\tore_granite: ['ore_granite_upper', 'ore_granite_lower'],\n\tore_diorite: ['ore_diorite_upper', 'ore_diorite_lower'],\n\tore_andesite: ['ore_andesite_upper', 'ore_andesite_lower'],\n\tore_coal: ['ore_coal_upper', 'ore_coal_lower'],\n\tore_iron: ['ore_iron_upper', 'ore_iron_middle', 'ore_iron_small'],\n\tore_gold: ['ore_gold', 'ore_gold_lower'],\n\tore_redstone: ['ore_redstone', 'ore_redstone_lower'],\n\tore_diamond: ['ore_diamond', 'ore_diamond_large', 'ore_diamond_buried'],\n\tore_lapis: ['ore_lapis', 'ore_lapis_buried'],\n}))\n\n// Configured features in 1.17 that were fully removed\nconst FeatureFullyRemoved = new Set(['lake_water', 'rare_dripstone_cluster', 'rare_small_dripstone', 'ore_deepslate'])\n\n// Configured features in 1.17 that have no corresponding placed feature in 1.18\nconst FeatureOnlyConfig = new Set(['azalea_tree', 'birch_bees_005', 'bonus_chest', 'cave_vine_in_moss', 'clay_pool_with_dripleaves', 'clay_with_dripleaves', 'dripleaf', 'end_gateway_delayed', 'huge_brown_mushroom', 'huge_red_mushroom', 'jungle_tree_no_vine', 'moss_patch', 'moss_patch_bonemeal', 'moss_patch_ceiling', 'moss_vegetation', 'oak_bees_005', 'patch_brown_mushroom', 'patch_red_mushroom', 'spring_lava_double', 'swamp_oak'])\n\n// Configured features in 1.17 that have a corresponding placed feature, but their configured feature was removed.\nconst FeatureOnlyPlacement = new Set(['patch_dead_bush_2'])\n\n// Configured features in 1.17 that got a new name as placed feature and configured feature in 1.18\nconst FeatureRenames = new Map(Object.entries({\n\tbirch_other: 'trees_birch_and_oak',\n\tend_gateway: 'end_gateway_return',\n\tfancy_oak_bees_005: 'fancy_oak_bees',\n\tflower_forest: 'flower_flower_forest',\n\tforest_flower_trees: 'trees_flower_forest',\n\tforest_flower_vegetation: 'forest_flowers',\n\tforest_flower_vegetation_common: 'flower_forest_flowers',\n\tgrove_vegetation: 'trees_grove',\n\tmushroom_field_vegetation: 'mushroom_island_vegetation',\n\tore_debris_large: 'ore_ancient_debris_large',\n\tpatch_waterlilly: 'patch_waterlily',\n\tpine: 'pine_checked',\n\tplain_vegetation: 'trees_plains',\n\trooted_azalea_trees: 'rooted_azalea_tree',\n\ttaiga_vegetation: 'trees_taiga',\n\ttrees_giant: 'trees_old_growth_pine_taiga',\n\ttrees_giant_spruce: 'trees_old_growth_spruce_taiga',\n\ttrees_jungle_edge: 'trees_sparse_jungle',\n\ttrees_mountain: 'trees_windswept_hills',\n}))\n\n// Configured features in 1.17 that got a new name as placed feature in 1.18 but have no configured feature with this new name\nconst FeatureRenamesPlacement = new Map(Object.entries({\n\tacacia: 'acacia_checked',\n\tbirch: 'birch_checked',\n\tbrown_mushroom_giant: 'brown_mushroom_old_growth',\n\tcave_vine: 'cave_vines',\n\tdark_oak: 'dark_oak_checked',\n\tend_island: 'end_island_decorated',\n\tfancy_oak: 'fancy_oak_checked',\n\tflower_plain_decorated: 'flower_plains',\n\tmeadow_trees: 'trees_meadow',\n\tmega_jungle_tree: 'mega_jungle_tree_checked',\n\tmega_pine: 'mega_pine_checked',\n\tred_mushroom_giant: 'red_mushroom_old_growth',\n\tpatch_cactus: 'patch_cactus_decorated',\n\tmega_spruce: 'mega_spruce_checked',\n\tspruce: 'spruce_checked',\n\ttrees_mountain_edge: 'trees_windswept_forest',\n\ttrees_shattered_savanna: 'trees_windswept_savanna',\n}))\n\n// Configured features in 1.17 that got a new name as configured feature in 1.18 but have no placed feature with this new name\nconst FeatureRenamesConfig = new Map(Object.entries({\n\tmega_spruce: 'mega_spruce',\n\tcave_vine: 'cave_vine', // entry is included because the placed feature was renamed\n\tcrimson_fungi_planted: 'crimson_fungus_planted',\n\twarped_fungi_planted: 'warped_fungus_planted',\n}))\n\nconst CarverRemovals = new Set(['ocean_cave', 'prototype_canyon', 'prototype_cave', 'prototype_crevice', 'underwater_canyon', 'underwater_cave'])\n","import type { FixContext } from '../../Fix'\nimport type { Pack } from '../../Pack'\n\ntype FeatureData = {\n\tid: string,\n\tbiome: string,\n\tdepends: Set<string>,\n}\n\nconst STEPS = ['raw_generation', 'lakes', 'local_modifications', 'underground_structures', 'surface_structures', 'strongholds', 'underground_ores', 'underground_decoration', 'fluid_springs', 'vegetal_decoration', 'top_layer_modification']\n\nexport async function CycleOrder(pack: Pack, ctx: FixContext) {\n\tconst biomes = pack.data['worldgen/biome'].filter(f => !f.error)\n\n\tconst biomesWithDuplicates = new Set<string>()\n\tfor (let step = 0; step < STEPS.length; step += 1) {\n\t\tconst features: FeatureData[] = []\n\t\tfor (const biome of biomes) {\n\t\t\tconst stepFeatures: string[] = biome.data.features[step] ?? []\n\t\t\tfor (let index = 0; index < stepFeatures.length; index += 1) {\n\t\t\t\tconst id = stepFeatures[index]\n\t\t\t\tif (features.some(f => f.biome === biome.name && f.id === id)) {\n\t\t\t\t\tbiomesWithDuplicates.add(biome.name)\n\t\t\t\t\tcontinue\n\t\t\t\t}\n\t\t\t\tconst depends = new Set(stepFeatures.slice(0, index))\n\t\t\t\tfeatures.push({ id, biome: biome.name, depends })\n\t\t\t}\n\t\t}\n\n\t\tconst sortedFeatures: FeatureData[] = []\n\t\tconst startFeatures = features.filter(f => features.filter(g => f.id === g.id).every(g => g.depends.size === 0))\n\t\twhile (startFeatures.length > 0) {\n\t\t\tconst node = startFeatures.pop()!\n\t\t\tif (sortedFeatures.some(f => f.id === node.id)) continue\n\t\t\tsortedFeatures.push(node)\n\t\t\tfor (const member of features.filter(f => f.depends.has(node.id))) {\n\t\t\t\tmember.depends.delete(node.id)\n\t\t\t\tif (features.filter(g => member.id === g.id).every(g => g.depends.size === 0)) {\n\t\t\t\t\tstartFeatures.push(member)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// There is at least one cycle\n\t\tif (features.some(f => f.depends.size > 0)) {\n\t\t\tconst visitedBiomes = new Set<string>()\n\t\t\tconst visitedFeatures = new Set<string>()\n\t\t\tfunction findCycle(node: FeatureData, start: FeatureData, depth: number): false | FeatureData[] {\n\t\t\t\tif (depth <= 0) return false\n\t\t\t\tvisitedBiomes.add(node.biome)\n\t\t\t\tvisitedFeatures.add(node.id)\n\t\t\t\tfor (const dep of node.depends) {\n\t\t\t\t\tif (dep === start.id) {\n\t\t\t\t\t\treturn [start]\n\t\t\t\t\t}\n\t\t\t\t\tif (visitedFeatures.has(dep)) continue\n\t\t\t\t\tfor (const member of features.filter(f => f.id === dep && !visitedBiomes.has(f.biome))) {\n\t\t\t\t\t\tconst cycle = findCycle(member, start, depth - 1)\n\t\t\t\t\t\tif (cycle) {\n\t\t\t\t\t\t\treturn [member, ...cycle]\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvisitedBiomes.delete(node.biome)\n\t\t\t\treturn false\n\t\t\t}\n\n\t\t\tlet cycle: false | FeatureData[] = false\n\t\t\tconst startCandidates = features.filter(f => f.depends.size > 0)\n\t\t\touter:\n\t\t\tfor (let depth = 2; depth < 10; depth += 1) {\n\t\t\t\tfor (const start of startCandidates) {\n\t\t\t\t\tvisitedBiomes.clear()\n\t\t\t\t\tvisitedFeatures.clear()\n\t\t\t\t\tcycle = findCycle(start, start, depth)\n\t\t\t\t\tif (cycle) break outer\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (cycle) {\n\t\t\t\tconst info = [`Cycle in step ${step} (${STEPS[step]}):`]\n\t\t\t\tfor (let i = cycle.length - 1; i >= 0; i -= 1) {\n\t\t\t\t\tconst node = cycle[i]\n\t\t\t\t\tconst nextNode = cycle[(i + 1 + cycle.length) % cycle.length]\n\t\t\t\t\tinfo.push(` Biome ${node.biome}: '${nextNode.id}' -> '${node.id}'`)\n\t\t\t\t}\n\t\t\t\tctx.warn('!Feature order cycle found. Needs manual fixing.', [], info)\n\t\t\t}\n\t\t}\n\t}\n\n\tif (biomesWithDuplicates.size > 0) {\n\t\tctx.warn('!Detected duplicate features. They are no longer allowed.', [...biomesWithDuplicates])\n\t}\n}\n\n// Code to check if features are in different steps\n/*\n\n\tconst features: FeatureData[] = []\n\tfor (const biome of biomes) {\n\t\tconst biomeFeatures = biome.data.features as string[][]\n\t\tfor (let step = 0; step < biomeFeatures.length; step += 1) {\n\t\t\tconst stepFeatures = biomeFeatures[step] as string[]\n\t\t\tfor (let index = 0; index < stepFeatures.length; index += 1) {\n\t\t\t\tconst feature = stepFeatures[index]\n\t\t\t\tconst before = new Set(stepFeatures.slice(0, index))\n\t\t\t\tconst after = new Set(stepFeatures.slice(index + 1))\n\t\t\t\tfeatures.push({ feature, step, biomes: new Set([biome.name]), before, after })\n\t\t\t}\n\t\t}\n\t}\n\n\t// Detect when a feature appears in multiple steps\n\tconst featureSteps = new Map<string, Set<number>>()\n\tfor (const data of features) {\n\t\tconst steps = featureSteps.get(data.feature)\n\t\tif (steps === undefined) {\n\t\t\tfeatureSteps.set(data.feature, new Set([data.step]))\n\t\t} else {\n\t\t\tsteps.add(data.step)\n\t\t}\n\t}\n\tfor (const [feature, steps] of featureSteps) {\n\t\tif (steps.size > 1) {\n\t\t\tconst choice = parseInt(await ctx.prompt(\n\t\t\t\t`Feature order cycle found: Conflicting steps for feature \"${feature}\"`,\n\t\t\t\t'Which step should it be in?',\n\t\t\t\t[...steps].map(s => s.toFixed())\n\t\t\t))\n\t\t\t// Correct the features which were in a different step\n\t\t\tfeatures.filter(f => f.feature === feature && f.step !== choice).forEach(f => {\n\t\t\t\tf.step = choice\n\t\t\t\tf.before.clear()\n\t\t\t\tf.after.clear()\n\t\t\t})\n\t\t}\n\t}\n\t*/\n","import { Fix } from '../../Fix'\n\nexport const NoiseSettings = Fix.all(\n\tFix.onFile('worldgen/noise_settings', ({ data }) => fixNoiseSettings(data)),\n\tFix.onFile('dimension', ({ data }) => {\n\t\tif (data.generator?.type?.replace(/^minecraft:/, '') === 'noise') {\n\t\t\tfixNoiseSettings(data.generator.settings)\n\t\t}\n\t}),\n)\n\nfunction fixNoiseSettings(data: any) {\n\tfixSurfaceRule(data.surface_rule)\n}\n\nfunction fixSurfaceRule(data: any) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'sequence':\n\t\t\tdata.sequence.forEach((s: any) => fixSurfaceRule(s))\n\t\t\tbreak\n\t\tcase 'condition':\n\t\t\tfixSurfaceCondition(data.if_true)\n\t\t\tfixSurfaceRule(data.then_run)\n\t}\n}\n\nfunction fixSurfaceCondition(data: any) {\n\tif (typeof data !== 'object') return\n\tconst condition = data.type.replace(/^minecraft:/, '')\n\tswitch (condition) {\n\t\tcase 'not':\n\t\t\tfixSurfaceCondition(data.invert)\n\t\t\tbreak\n\t\tcase 'stone_depth':\n\t\t\tdata.offset = 0\n\t\t\tdata.add_surface_depth = data.add_run_depth\n\t\t\tdata.add_surface_secondary_depth = false\n\t\t\tdelete data.add_run_depth\n\t\t\tbreak\n\t\tcase 'water':\n\t\tcase 'y_above':\n\t\t\tdata.surface_depth_multiplier = data.run_depth_multiplier\n\t\t\tdelete data.run_depth_multiplier\n\t}\n}\n","import { Fix } from '../../Fix'\nimport { Feature } from './Feature'\nimport { CycleOrder } from './FeatureCycles'\nimport { NoiseSettings } from './NoiseSettings'\n\nexport const Fixes18 = Fix.all(\n\tFix.version('21w44a', '1.18.1', Fix.groupProblems(\n\t\tFix.debug('1.18 fixes'),\n\t\tFix.when('worldgen',\n\t\t\tFeature,\n\t\t\tNoiseSettings\n\t\t),\n\t)),\n\tFix.versionInclusive('1.18.1', '1.18.1',\n\t\tFix.when('featureCycles',\n\t\t\tFix.debug('Checking feature order cycle'),\n\t\t\tCycleOrder\n\t\t)\n\t)\n)\n","import { Fix } from '../../Fix'\n\nexport const Dimension = Fix.all(\n\tFix.onFile('dimension', ({ data }) => fixGenerator(data.generator)),\n)\n\nfunction fixGenerator(data: any) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'flat':\n\t\t\tif (typeof data.settings !== 'object') return\n\t\t\tdata.settings.structure_overrides = []\n\t\t\tdelete data.settings.structures\n\t}\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Fix infiniburn tag\n */\nexport const DimensionType = Fix.all(\n\tFix.onFile('dimension_type', ({ data }) => fixDimensionType(data)),\n\tFix.onFile('dimension', ({ data }) => {\n\t\tif (typeof data.type === 'object') {\n\t\t\tfixDimensionType(data.type)\n\t\t}\n\t}),\n)\n\nfunction fixDimensionType(data: any) {\n\tdata.infiniburn = '#' + data.infiniburn\n}\n","import { Fix } from '../../Fix'\n\nexport const NoiseSettings = Fix.all(\n\tFix.onFile('worldgen/noise_settings', ({ data }) => fixNoiseSettings(data)),\n\tFix.onFile('dimension', ({ data }) => {\n\t\tif (data.generator?.type?.replace(/^minecraft:/, '') === 'noise') {\n\t\t\tfixNoiseSettings(data.generator.settings)\n\t\t}\n\t}),\n)\n\nfunction fixNoiseSettings(data: any) {\n\tfixSurfaceRule(data.surface_rule)\n\n\t// TODO: create noise router\n\tdelete data.noise_caves_enabled\n\tdelete data.noodle_caves_enabled\n\tdelete data.noise.island_noise_override\n\tdelete data.noise.amplified\n\tdelete data.noise.large_biomes\n\n\t// TODO: create structure sets\n\tdelete data.structures\n}\n\nfunction fixSurfaceRule(data: any) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'sequence':\n\t\t\tdata.sequence.forEach((s: any) => fixSurfaceRule(s))\n\t\t\tbreak\n\t\tcase 'condition':\n\t\t\tfixSurfaceCondition(data.if_true)\n\t\t\tfixSurfaceRule(data.then_run)\n\t}\n}\n\nfunction fixSurfaceCondition(data: any) {\n\tif (typeof data !== 'object') return\n\tconst condition = data.type.replace(/^minecraft:/, '')\n\tswitch (condition) {\n\t\tcase 'not':\n\t\t\tfixSurfaceCondition(data.invert)\n\t\t\tbreak\n\t\tcase 'stone_depth':\n\t\t\tdata.offset = 0\n\t\t\tdata.add_surface_depth = data.add_run_depth\n\t\t\tdata.add_surface_secondary_depth = false\n\t\t\tdelete data.add_run_depth\n\t\t\tbreak\n\t\tcase 'water':\n\t\tcase 'y_above':\n\t\t\tdata.surface_depth_multiplier = data.run_depth_multiplier\n\t\t\tdelete data.run_depth_multiplier\n\t}\n}\n","import { Fix } from '../../Fix'\n\n/**\n * Fixes feature in location predicate\n */\nexport const Predicates = Fix.all(\n\tFix.onFile('predicates', ({ data }) => {\n\t\tif (Array.isArray(data)) {\n\t\t\tdata.forEach(fixCondition)\n\t\t} else {\n\t\t\tfixCondition(data)\n\t\t}\n\t}),\n\tFix.onFile('advancements', ({ data }) => {\n\t\tObject.values(data.criteria).forEach(fixCriterion)\n\t}),\n\tFix.onFile('loot_tables', ({ data }) => {\n\t\tdata.pools?.forEach(fixPool)\n\t}),\n)\n\nfunction fixCriterion(data: any) {\n\tif (typeof data.conditions !== 'object') return\n\n\tfixEntity(data.conditions.entity)\n\tfixEntity(data.conditions.player)\n\tfixEntity(data.conditions.parent)\n\tfixEntity(data.conditions.partner)\n\tfixEntity(data.conditions.child)\n\tfixEntity(data.conditions.villager)\n\tfixEntity(data.conditions.zombie)\n\tfixEntity(data.conditions.projectile)\n\tfixEntity(data.conditions.shooter)\n\tdata.conditions.victims?.forEach(fixEntity)\n\n\tfixDamage(data.conditions.damage)\n\tfixDamage(data.conditions.killing_blow)\n\t\n\tfixLocation(data.conditions.location)\n\tfixLocation(data.conditions.entered)\n\tfixLocation(data.conditions.exited)\n}\n\nfunction fixPool(data: any) {\n\tdata.entries?.forEach(fixEntry)\n\tdata.conditions?.forEach(fixCondition)\n}\n\nfunction fixEntry(data: any) {\n\tdata.children?.forEach(fixEntry)\n\tdata.conditions?.forEach(fixCondition)\n}\n\nfunction fixCondition(data: any) {\n\tconst condition = data.condition.replace(/^minecraft:/, '')\n\tswitch (condition) {\n\t\tcase 'entity_properties':\n\t\t\tfixEntity(data.predicate)\n\t\t\tbreak\n\t\tcase 'damage_source_properties':\n\t\t\tfixDamage(data.predicate)\n\t\t\tbreak\n\t\tcase 'location_check':\n\t\t\tfixLocation(data.predicate)\n\t\t\tbreak\n\t}\n}\n\nfunction fixDamage(data: any) {\n\tif (typeof data !== 'object') return\n\n\tfixEntity(data.source_entity)\n\tfixEntity(data.direct_entity)\n\tfixDamage(data.type)\n}\n\nfunction fixEntity(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (Array.isArray(data)) {\n\t\tdata.forEach(fixCondition)\n\t\treturn\n\t}\n\n\tfixEntity(data.vehicle)\n\tfixEntity(data.targeted_entity)\n\tfixLocation(data.location)\n}\n\nfunction fixLocation(data: any) {\n\tif (typeof data !== 'object') return\n\n\tif (typeof data.feature === 'string') {\n\t\tswitch (data.feature) {\n\t\t\tcase 'endcity':\n\t\t\t\tdata.feature = 'minecraft:end_city'\n\t\t\t\tbreak\n\t\t\tdefault:\n\t\t\t\tdata.feature = 'minecraft:' + data.feature\n\t\t}\n\t}\n}\n","import { Fix } from '../../Fix'\nimport { Dimension } from './Dimension'\nimport { DimensionType } from './DimensionType'\nimport { NoiseSettings } from './NoiseSettings'\nimport { Predicates } from './Predicates'\n\nexport const Fixes182 = Fix.version('1.18.1', '1.18.2', Fix.groupProblems(\n\tFix.debug('1.18.2 fixes'),\n\tFix.assert(pack => pack.meta.data.pack.pack_format < 9, 'This pack already has pack_format 9 or higher and cannot be upgraded.'),\n\tFix.when('worldgen',\n\t\tDimensionType,\n\t\tNoiseSettings,\n\t\tDimension,\n\t),\n\tFix.when('predicates',\n\t\tPredicates,\n\t),\n\tFix.when('packFormat', async pack => pack.meta.data.pack.pack_format = 9),\n))\n","import { Fix } from '../../Fix'\n\nexport const Advancement = Fix.all(\n\tFix.onFile('advancements', ({ data }) => {\n\t\tObject.values(data.criteria).forEach(fixCriterion)\n\t}),\n)\n\nfunction fixCriterion(data: any) {\n\tconst trigger = data.trigger.replace(/^minecraft:/, '')\n\tswitch (trigger) {\n\t\tcase 'nether_travel':\n\t\t\tif (typeof data.conditions !== 'object') break\n\t\t\tconst { distance, entered, exited, player } = data.conditions\n\t\t\tdata.conditions = {\n\t\t\t\tplayer: mergePlayerLocation(player, exited),\n\t\t\t\tstart_position: entered,\n\t\t\t\tdistance: distance,\n\t\t\t}\n\t\t\tbreak\n\t}\n}\n\nfunction mergePlayerLocation(player: any, location: any) {\n\tif (player === undefined) return { location }\n\tif (Array.isArray(player) && player.length >= 1) {\n\t\treturn [player, { type: 'minecraft:entity_properties', predicate: { location } }]\n\t}\n\treturn {\n\t\t...player,\n\t\tlocation: {\n\t\t\t...player.location,\n\t\t\t...location,\n\t\t},\n\t}\n}\n","import type { FixContext } from '../../Fix'\nimport { Fix } from '../../Fix'\nimport type { PackFile } from '../../Pack'\n\nexport const Biome = Fix.all(\n\tFix.onFile('worldgen/biome', fixBiome),\n)\n\nfunction fixBiome({ data }: PackFile, ctx: FixContext) {\n\tctx.warn('Biome \"depth\" and \"scale\" were removed and replaced with a more powerful terrain shaper option in noise settings. No automatic upgrade possible.')\n\tdata.depth = undefined\n\tdata.scale = undefined\n\n\tctx.warn('Biome \"surface_builder\" was removed and replaced with a more powerful surface_rule option in noise settings. No automatic upgrade possible.')\n\tdata.surface_builder = undefined\n\n\tif (Array.isArray(data.starts) && data.starts.length > 0) {\n\t\tctx.warn('Biome \"starts\" was removed, custom structures are not supported in 1.18.')\n\t}\n\tdata.starts = undefined\n\n\tif (Array.isArray(data.features) && data.features.length >= 9) {\n\t\t(data.features as any[]).splice(8, 0, [])\n\t}\n\n\t// Particle fix (should've been in 1.16 -> 1.17)\n\tconst particle = data.effects.particle?.options\n\tif (particle?.type?.replace(/minecraft:/, '') === 'dust' && particle.r) {\n\t\tdata.effects.particle.options = {\n\t\t\ttype: 'minecraft:dust',\n\t\t\tcolor: [particle.r, particle.g, particle.b],\n\t\t\tscale: particle.scale,\n\t\t}\n\t}\n}\n","import type { FixContext } from '../../Fix'\nimport { Fix } from '../../Fix'\n\nexport const Dimension = Fix.all(\n\tFix.onFile('dimension', ({ data }, ctx) => {\n\t\tif (data.generator?.type?.replace(/^minecraft:/, '') === 'noise') {\n\t\t\tconst biomes = fixBiomeSource(data.generator.biome_source, ctx)\n\t\t\tfixNoiseSettings(data.generator.settings, ctx, biomes)\n\t\t}\n\t}),\n\tFix.onFile('worldgen/noise_settings', ({ data }, ctx) => {\n\t\tfixNoiseSettings(data, ctx)\n\t}),\n)\n\n// Returns a list of biome IDs\nfunction fixBiomeSource(data: any, ctx: FixContext) {\n\tif (typeof data !== 'object') return []\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'fixed':\n\t\t\treturn [data.biome]\n\t\tcase 'checkerboard':\n\t\t\treturn [...new Set<string>(data.biomes)]\n\t\tcase 'multi_noise':\n\t\t\tdata.seed = undefined\n\t\t\tif (data.preset?.replace(/^minecraft:/, '') === 'nether') {\n\t\t\t\treturn ['nether_wastes', 'soul_sand_valley', 'crimson_forest', 'warped_forest', 'basalt_deltas']\n\t\t\t}\n\t\t\tdata.altitude_noise = undefined\n\t\t\tdata.temperature_noise = undefined\n\t\t\tdata.humidity_noise = undefined\n\t\t\tdata.weirdness_noise = undefined\n\t\t\tdata.biomes.forEach((b: any) => {\n\t\t\t\tb.parameters = {\n\t\t\t\t\ttemperature: b.parameters.temperature,\n\t\t\t\t\thumidity: b.parameters.humidity,\n\t\t\t\t\tcontinentalness: b.parameters.altitude,\n\t\t\t\t\terosion: 0,\n\t\t\t\t\tweirdness: b.parameters.weirdness,\n\t\t\t\t\tdepth: 0,\n\t\t\t\t\toffset: b.parameters.offset,\n\t\t\t\t}\n\t\t\t})\n\t\t\treturn [...new Set<string>(data.biomes.map((b: any) => b.biome))]\n\t\tcase 'vanilla_layered':\n\t\t\tctx.warn('Removed biome source \"vanilla_layered\", replaced with the multi noise overworld preset.')\n\t\t\tdata.type = 'multi_noise'\n\t\t\tdata.preset = 'minecraft:overworld'\n\t\t\treturn []\n\t}\n\treturn []\n}\n\nfunction fixNoiseSettings(data: any, ctx: FixContext, biomes: string[] = []) {\n\tif (typeof data === 'string') {\n\t\tconst file = ctx.read('worldgen/noise_settings', data)\n\t\tif (file) {\n\t\t\tfixNoiseSettings(file.data, ctx, biomes)\n\t\t}\n\t\treturn\n\t}\n\tif (typeof data !== 'object') return\n\n\tif (data.surface_rule !== undefined) return\n\n\tdata.legacy_random_source = false\n\n\tdata.noise.top_slide.target /= 128\n\tdata.noise.bottom_slide.target /= 128\n\t\n\tdata.min_surface_level = undefined\n\tdata.noise.simplex_surface_noise = undefined\n\tdata.noise.random_density_offset = undefined\n\n\tdata.noise.terrain_shaper = {\n\t\toffset: 0,\n\t\tfactor: 0,\n\t\tjaggedness: 0,\n\t}\n\n\tdata.noise.density_offset = undefined\n\tdata.noise.density_factor = undefined\n\n\tconst rules = []\n\n\tif (data.bedrock_floor_position > -10) {\n\t\trules.push(ifTrue('vertical_gradient', {\n\t\t\trandom_name: 'minecraft:bedrock_floor',\n\t\t\ttrue_at_and_below: { above_bottom: data.bedrock_floor_position + 5 },\n\t\t\tfalse_at_and_above: { above_bottom: data.bedrock_floor_position },\n\t\t}).thenRun('block', {\n\t\t\tresult_state: { Name: 'minecraft:bedrock' },\n\t\t}))\n\t}\n\tif (data.bedrock_roof_position > -10) {\n\t\trules.push(ifNotTrue('vertical_gradient', {\n\t\t\trandom_name: 'minecraft:bedrock_roof',\n\t\t\ttrue_at_and_below: { below_top: data.bedrock_roof_position + 5 },\n\t\t\tfalse_at_and_above: { below_top: data.bedrock_roof_position },\n\t\t}).thenRun('block', {\n\t\t\tresult_state: { Name: 'minecraft:bedrock' },\n\t\t}))\n\t}\n\t// TODO: add surface rules for the biomes\n\tif (data.deepslate_enabled) {\n\t\trules.push(ifTrue('vertical_gradient', {\n\t\t\trandom_name: 'minecraft:deepslate',\n\t\t\ttrue_at_and_below: { absolute: 0 },\n\t\t\tfalse_at_and_above: { absolute: 8 },\n\t\t}).thenRun('block', {\n\t\t\tresult_state: { Name: 'minecraft:deepslate', Properties: { axis: 'y' } },\n\t\t}))\n\t}\n\n\tdata.surface_rule = {\n\t\ttype: 'minecraft:sequence',\n\t\tsequence: rules,\n\t}\n}\n\nfunction ifTrue(conditionType: string, conditionData: any) {\n\treturn {\n\t\tthenRun: (ruleType: string, ruleData: any) => ({\n\t\t\ttype: 'minecraft:condition',\n\t\t\tif_true: { type: `minecraft:${conditionType}`, ...conditionData },\n\t\t\tthen_run: { type: `minecraft:${ruleType}`, ...ruleData },\n\t\t}),\n\t}\n}\n\nfunction ifNotTrue(conditionType: string, conditionData: any) {\n\treturn ifTrue('not', {\n\t\tinvert: { type: `minecraft:${conditionType}`, ...conditionData },\n\t})\n}\n","import type { FixContext } from '../../Fix'\nimport { Fix } from '../../Fix'\n\nexport const Feature = Fix.all(\n\tFix.onFile('worldgen/configured_feature', ({ data }, ctx) => fixFeature(data, ctx)),\n)\n\nfunction fixFeature(data: any, ctx: FixContext) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'decorated':\n\t\t\tfixDecorator(data.config.decorator, ctx)\n\t\t\tfixFeature(data.config.feature, ctx)\n\t\t\tbreak\n\t\tcase 'random_boolean_selector':\n\t\t\tfixFeature(data.config.feature_false, ctx)\n\t\t\tfixFeature(data.config.feature_true, ctx)\n\t\t\tbreak\n\t\tcase 'random_selector':\n\t\t\tdata.config.features.forEach((e: any) => fixFeature(e.feature, ctx))\n\t\t\tfixFeature(data.config.default, ctx)\n\t\t\tbreak\n\t\tcase 'simple_random_selector':\n\t\t\tdata.config.features.forEach((feature: any) => fixFeature(feature, ctx))\n\t\t\tbreak\n\t\tcase 'flower':\n\t\tcase 'no_bonemeal_flower':\n\t\tcase 'random_patch':\n\t\t\tif (data.config.xspread !== data.config.zspread) {\n\t\t\t\tctx.warn('Random patch xspread and zspread can no longer be different. Using xspread.')\n\t\t\t}\n\t\t\tconst filters: any[] = []\n\t\t\tif (data.config.can_replace !== true) {\n\t\t\t\tfilters.push({\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\tblocks: ['minecraft:air'],\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (isNonEmptyList(data.config.whitelist)) {\n\t\t\t\tfilters.push({\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\toffset: [0, -1, 0],\n\t\t\t\t\tblocks: getBlockIds(data.config.whitelist),\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (isNonEmptyList(data.config.blacklist)) {\n\t\t\t\tfilters.push({\n\t\t\t\t\ttype: 'minecraft:not',\n\t\t\t\t\tpredicate: {\n\t\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\t\toffset: [0, -1, 0],\n\t\t\t\t\t\tblocks: getBlockIds(data.config.blacklist),\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t}\n\t\t\tconst placer = data.config.block_placer.type.replace(/^minecraft:/, '')\n\t\t\tconst feature = placer === 'column_placer' ? {\n\t\t\t\ttype: 'minecraft:block_column',\n\t\t\t\tconfig: {\n\t\t\t\t\tdirection: 'up',\n\t\t\t\t\tallowed_placement: data.config.can_replace !== true ? {\n\t\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\t\tblocks: ['minecraft:air'],\n\t\t\t\t\t} : { type: 'minecraft:true' },\n\t\t\t\t\tprioritize_tip: false,\n\t\t\t\t\tlayers: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\theight: data.config.block_placer.size,\n\t\t\t\t\t\t\tprovider: data.config.state_provider,\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t} : {\n\t\t\t\ttype: 'minecraft:simple_block',\n\t\t\t\tconfig: {\n\t\t\t\t\tto_place: data.config.state_provider,\n\t\t\t\t},\n\t\t\t}\n\t\t\tdata.config = {\n\t\t\t\ttries: data.config.tries,\n\t\t\t\txz_spread: data.config.xspread,\n\t\t\t\ty_spread: data.config.yspread,\n\t\t\t\tfeature: decorated(feature, [\n\t\t\t\t\t{\n\t\t\t\t\t\ttype: 'minecraft:block_filter',\n\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\tpredicate: {\n\t\t\t\t\t\t\t\ttype: 'minecraft:all_of',\n\t\t\t\t\t\t\t\tpredicates: filters,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t]),\n\t\t\t}\n\t\t\tif (data.config.project === true) {\n\t\t\t\tdata.config = {\n\t\t\t\t\tdecorator: {\n\t\t\t\t\t\ttype: 'heightmap',\n\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\theightmap: 'OCEAN_FLOOR',\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tfeature: {\n\t\t\t\t\t\ttype: data.type,\n\t\t\t\t\t\tconfig: data.config,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t\tdata.type = 'minecraft:decorated'\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'growing_plant':\n\t\t\tdata.type = 'minecraft:block_column'\n\t\t\tdata.config = {\n\t\t\t\tdirection: data.config.direction,\n\t\t\t\tallowed_placement: data.config.allow_water !== true ? {\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\tblocks: ['minecraft:air'],\n\t\t\t\t} : { type: 'minecraft:true' },\n\t\t\t\tprioritize_tip: true,\n\t\t\t\tlayers: [\n\t\t\t\t\t{\n\t\t\t\t\t\theight: {\n\t\t\t\t\t\t\ttype: 'minecraft:weighted_list',\n\t\t\t\t\t\t\tdistribution: data.config.height_distribution.map((e: any) => ({\n\t\t\t\t\t\t\t\tweight: e.weight,\n\t\t\t\t\t\t\t\tdata: deltaIntProvider(e.data, -1, 0, Infinity),\n\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t},\n\t\t\t\t\t\tprovider: data.config.body_provider,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\theight: 1,\n\t\t\t\t\t\tprovider: data.config.head_provider,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'root_system':\n\t\t\tfixFeature(data.config.feature, ctx)\n\t\t\tbreak\n\t\tcase 'simple_block':\n\t\t\tconst filters2 = []\n\t\t\tif (isNonEmptyList(data.config.place_on)) {\n\t\t\t\tfilters2.push({\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\toffset: [0, -1, 0],\n\t\t\t\t\tblocks: getBlockIds(data.config.place_on),\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (isNonEmptyList(data.config.place_in)) {\n\t\t\t\tfilters2.push({\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\tblocks: getBlockIds(data.config.place_in),\n\t\t\t\t})\n\t\t\t}\n\t\t\tif (isNonEmptyList(data.config.place_under)) {\n\t\t\t\tfilters2.push({\n\t\t\t\t\ttype: 'minecraft:matching_blocks',\n\t\t\t\t\toffset: [0, 1, 0],\n\t\t\t\t\tblocks: getBlockIds(data.config.place_under),\n\t\t\t\t})\n\t\t\t}\n\t\t\tdata.config.place_on = undefined\n\t\t\tdata.config.place_in = undefined\n\t\t\tdata.config.place_under = undefined\n\t\t\tif (filters2.length > 0) {\n\t\t\t\tdata.type = 'minecraft:decorated',\n\t\t\t\tdata.config = {\n\t\t\t\t\tdecorator: {\n\t\t\t\t\t\ttype: 'minecraft:block_filter',\n\t\t\t\t\t\tconfig: {\n\t\t\t\t\t\t\tpredicate: filters2.length == 1 ? filters2[0] : {\n\t\t\t\t\t\t\t\ttype: 'minecraft:all_of',\n\t\t\t\t\t\t\t\tpredicates: filters2,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\tfeature: {\n\t\t\t\t\t\ttype: 'minecraft:simple_block',\n\t\t\t\t\t\tconfig: data.config,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak\n\t\tcase 'small_dripstone':\n\t\t\tconst pointed_dripstone = (surface: string) => decorated({\n\t\t\t\ttype: 'minecraft:pointed_dripstone',\n\t\t\t\tconfig: {\n\t\t\t\t\tchance_of_taller_dripstone: data.config.chance_of_taller_dripstone,\n\t\t\t\t\tchance_of_directional_spread: 0.7,\n\t\t\t\t\tchance_of_spread_radius2: 0.5,\n\t\t\t\t\tchance_of_spread_radius3: 0.5,\n\t\t\t\t},\n\t\t\t}, [{\n\t\t\t\ttype: 'minecraft:cave_surface',\n\t\t\t\tconfig: {\n\t\t\t\t\tsurface,\n\t\t\t\t\tfloor_to_ceiling_search_range: 12,\n\t\t\t\t\tallow_water: true,\n\t\t\t\t},\n\t\t\t}])\n\t\t\tdata.type = 'minecraft:decorated'\n\t\t\tdata.config = decorated({\n\t\t\t\ttype: 'minecraft:simple_random_selector',\n\t\t\t\tconfig: {\n\t\t\t\t\tfeatures: [\n\t\t\t\t\t\tpointed_dripstone('floor'),\n\t\t\t\t\t\tpointed_dripstone('ceiling'),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t}, [\n\t\t\t\t{\n\t\t\t\t\ttype: 'count',\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\tcount: {\n\t\t\t\t\t\t\ttype: 'minecraft:uniform',\n\t\t\t\t\t\t\tvalue: { min_inclusive: 1, max_inclusive: data.config.max_placements },\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\ttype: 'minecraft:scatter',\n\t\t\t\t\tconfig: {\n\t\t\t\t\t\txz_spread: {\n\t\t\t\t\t\t\ttype: 'minecraft:clamped_normal',\n\t\t\t\t\t\t\tvalue: { mean: 0.0, deviation: 3.0, min_inclusive: -10, max_inclusive: 10 },\n\t\t\t\t\t\t},\n\t\t\t\t\t\ty_spread: {\n\t\t\t\t\t\t\ttype: 'minecraft:clamped_normal',\n\t\t\t\t\t\t\tvalue: { mean: 0.0, deviation: 0.6, min_inclusive: -2, max_inclusive: 2 },\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t]).config\n\t\t\tbreak\n\t\tcase 'vegetation_patch':\n\t\tcase 'waterlogged_vegetation_patch':\n\t\t\tfixFeature(data.config.vegetation_feature, ctx)\n\t}\n}\n\nfunction deltaIntProvider(data: any, delta: number, min: number, max: number): any {\n\tif (typeof data === 'number') return data + delta\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'constant':\n\t\t\treturn {\n\t\t\t\ttype: data.type,\n\t\t\t\tvalue: Math.max(min, Math.min(max, data.value + delta)),\n\t\t\t}\n\t\tcase 'uniform':\n\t\tcase 'biased_to_bottom':\n\t\t\treturn {\n\t\t\t\ttype: data.type,\n\t\t\t\tvalue: {\n\t\t\t\t\tmin_inclusive: Math.max(min, Math.min(max, data.value.min_inclusive + delta)),\n\t\t\t\t\tmax_inclusive: Math.max(min, Math.min(max, data.value.max_inclusive + delta)),\n\t\t\t\t},\n\t\t\t}\n\t\tcase 'clamped':\n\t\t\treturn {\n\t\t\t\ttype: data.type,\n\t\t\t\tvalue: {\n\t\t\t\t\tmin_inclusive: Math.max(min, Math.min(max, data.value.min_inclusive + delta)),\n\t\t\t\t\tmax_inclusive: Math.max(min, Math.min(max, data.value.max_inclusive + delta)),\n\t\t\t\t\tsource: deltaIntProvider(data.value.source, delta, min, max),\n\t\t\t\t},\n\t\t\t}\n\t}\n\tthrow new Error(`Unknown int provider \"${type}\"`)\n}\n\nfunction fixDecorator(data: any, ctx: FixContext) {\n\tif (typeof data !== 'object') return\n\n\tconst type = data.type.replace(/^minecraft:/, '')\n\tswitch (type) {\n\t\tcase 'decorated':\n\t\t\tfixDecorator(data.config.outer, ctx)\n\t\t\tfixDecorator(data.config.inner, ctx)\n\t\t\tbreak\n\t\tcase 'cave_surface':\n\t\t\tdata.config.allow_water = false\n\t\t\tbreak\n\t\tcase 'heightmap_spread_double':\n\t\t\tctx.warn('Removed decorator \"heightmap_spread_double\" was replaced with \"heightmap\". You likely need to make this feature rarer.')\n\t\t\tdata.type = 'minecraft:heightmap'\n\t\t\tbreak\n\t\tcase 'spread_32_above':\n\t\t\tctx.warn('Removed decorator \"spread_32_above\". You likely need to make this feature rarer.')\n\t\t\tdata.type = 'minecraft:nope'\n\t\t\tbreak\n\t}\n}\n\nfunction decorated(feature: any, decorators: any[] = []): any {\n\tif (decorators.length == 0) {\n\t\treturn feature\n\t}\n\treturn {\n\t\ttype: 'minecraft:decorated',\n\t\tconfig: {\n\t\t\tdecorator: decorators[0],\n\t\t\tfeature: decorated(feature, decorators.slice(1)),\n\t\t},\n\t}\n}\n\nfunction isNonEmptyList(obj: unknown): obj is unknown[] {\n\treturn Array.isArray(obj) && obj.length > 0\n}\n\nfunction getBlockIds(states: any[]) {\n\treturn [...new Set(states.map((state: any) => state.Name))]\n}\n","import { Fix } from '../../Fix'\nimport { Advancement } from './Advancement'\nimport { Biome } from './Biome'\nimport { Dimension } from './Dimension'\nimport { Feature } from './Feature'\n\nexport const Fixes21w44a = Fix.version('1.17.1', '21w44a', Fix.groupProblems(\n\tFix.debug('21w44a fixes'),\n\tFix.assert(pack => pack.meta.data.pack.pack_format < 8, 'This pack already has pack_format 8 or higher and cannot be upgraded.'),\n\tFix.when('predicates', Advancement),\n\tFix.when('worldgen',\n\t\tDimension,\n\t\tFeature,\n\t\tBiome,\n\t),\n\tFix.when('packFormat', async pack => pack.meta.data.pack.pack_format = 8),\n))\n","import { Fix } from '../Fix'\nimport { Fixes17 } from './1.17'\nimport { Fixes18 } from './1.18'\nimport { Fixes182 } from './1.18.2'\nimport { Fixes21w44a } from './21w44a'\nimport { ParseErrors } from './ParseErrors'\n\nexport const Fixes = Fix.all(\n\tParseErrors,\n\tFixes17,\n\tFixes21w44a,\n\tFixes18,\n\tFixes182,\n)\n","import type { Fix } from '../Fix'\nimport { categories } from '../Pack'\n\nexport const ParseErrors: Fix = async (pack, ctx) => {\n\tcategories.forEach(category => {\n\t\tpack.data[category].filter(file => file.error).forEach(file => {\n\t\t\tctx.warn(`!${file.error}`)\n\t\t})\n\t})\n}\n","import detectIndent from 'detect-indent'\nimport type { JSZipObject } from 'jszip'\nimport JSZip from 'jszip'\nimport stripJsonComments from 'strip-json-comments'\nimport type { FixConfig, FixContext } from './Fix'\nimport { Fixes } from './fixes'\nimport type { Version } from './Version'\n\nexport const categories = [\n\t'advancements',\n\t'dimension',\n\t'dimension_type',\n\t'loot_tables',\n\t'predicates',\n\t'tags/blocks',\n\t'tags/items',\n\t'tags/worldgen/biome',\n\t'tags/worldgen/configured_structure_feature',\n\t'worldgen/biome',\n\t'worldgen/configured_carver',\n\t'worldgen/configured_feature',\n\t'worldgen/configured_structure_feature',\n\t'worldgen/configured_surface_builder',\n\t'worldgen/density_function',\n\t'worldgen/noise_settings',\n\t'worldgen/noise',\n\t'worldgen/placed_feature',\n\t'worldgen/processor_list',\n\t'worldgen/structure_set',\n\t'worldgen/template_pool',\n] as const\n\nexport type PackFile = {\n\tname: string,\n\tdata: any,\n\tindent?: string,\n\terror?: string,\n}\n\nexport type PackStatus = 'loaded' | 'upgrading' | 'upgraded' | 'writing' | 'done' | 'error'\n\nexport type PackError = {\n\tmessage: string,\n\tfiles: string[],\n}\n\nexport type Pack = {\n\tid: string,\n\tname: string,\n\troot: JSZip,\n\tstatus: PackStatus,\n\tmeta: PackFile,\n\tdata: {\n\t\t[category: string]: PackFile[],\n\t},\n}\n\nexport namespace Pack {\n\texport async function fromZip(file: File): Promise<Pack[]> {\n\t\tconst buffer = await file.arrayBuffer()\n\t\tconst zip = await JSZip.loadAsync(buffer)\n\n\t\tconst metaFiles = zip.filter(path => path.endsWith('pack.mcmeta') && !path.startsWith('__MACOSX/'))\n\t\tif (metaFiles.length === 0) {\n\t\t\tthrow new Error('Cannot find any \"pack.mcmeta\" files.')\n\t\t}\n\t\treturn Promise.all(metaFiles.map(metaFile => {\n\t\t\tconst rootPath = metaFile.name.replace(/\\/?pack.mcmeta$/, '')\n\t\t\tconst name = rootPath.length === 0 ? file.name : rootPath.split('/').pop()!\n\t\t\treturn loadPack(name, zip.folder(rootPath)!)\n\t\t}))\n\t}\n\n\tasync function loadPack(name: string, root: JSZip): Promise<Pack> {\n\t\tconst pack: Pack = {\n\t\t\tid: hexId(),\n\t\t\tname: name,\n\t\t\troot,\n\t\t\tstatus: 'loaded',\n\t\t\tdata: {},\n\t\t\tmeta: {\n\t\t\t\tname: 'pack',\n\t\t\t\t...await loadJson(root.file('pack.mcmeta')!),\n\t\t\t},\n\t\t}\n\t\tawait Promise.all(categories.map(async category => {\n\t\t\tpack.data[category] = await loadCategory(root.folder('data')!, category)\n\t\t}))\n\t\tpack.data.functions = await loadFunctions(root.folder('data')!)\n\t\tconsole.log(pack)\n\t\treturn pack\n\t}\n\n\tasync function loadCategory(root: JSZip, category: string): Promise<PackFile[]> {\n\t\tconst matcher = new RegExp(`([^\\/]+)\\/${category}\\/(.*)\\.json$`)\n\t\treturn Promise.all(root.filter((path) => path.match(matcher) !== null)\n\t\t\t.map(async file => {\n\t\t\t\tconst m = file.name.match(matcher)\n\t\t\t\tconst name = `${m![1]}:${m![2]}`\n\t\t\t\ttry {\n\t\t\t\t\tconst data = await loadJson(file)\n\t\t\t\t\treturn { name, ...data }\n\t\t\t\t} catch (e: any) {\n\t\t\t\t\treturn { name, data: undefined, error: e.message }\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\t}\n\n\tasync function loadJson(file: JSZipObject) {\n\t\tlet text = await loadText(file)\n\t\tconst indent = detectIndent(text).indent\n\t\ttry {\n\t\t\ttext = text.replaceAll('\\u200B', '').replaceAll('\\u200C', '').replaceAll('\\u200D', '').replaceAll('\\uFEFF', '')\n\t\t\ttext = text.split('\\n').map(l => l.replace(/^([^\"\\/]+)\\/\\/.*/, '$1')).join('\\n')\n\t\t\treturn { data: JSON.parse(stripJsonComments(text)), indent }\n\t\t} catch (e: any) {\n\t\t\tthrow new Error(`Cannot parse file \"${file.name}\": ${e.message}.`)\n\t\t}\n\t}\n\n\tasync function loadFunctions(root: JSZip): Promise<PackFile[]> {\n\t\tconst matcher = /([^\\/]+)\\/functions\\/(.*)\\.mcfunction$/\n\t\treturn Promise.all(root.filter((path) => path.match(matcher) !== null)\n\t\t\t.map(async file => {\n\t\t\t\tconst m = file.name.match(matcher)\n\t\t\t\treturn {\n\t\t\t\t\tname: `${m![1]}:${m![2]}`,\n\t\t\t\t\tdata: (await loadText(file)).split('\\n'),\n\t\t\t\t}\n\t\t\t})\n\t\t)\n\t}\n\n\tasync function loadText(file: JSZipObject) {\n\t\treturn await file.async('text')\n\t}\n\n\texport async function toZip(pack: Pack) {\n\t\tif (pack.status !== 'upgraded') {\n\t\t\tthrow new Error(`Cannot download pack with status ${pack.status}.`)\n\t\t}\n\t\tcategories.forEach(category => {\n\t\t\twriteCategory(pack.root.folder('data')!, category, pack.data[category] ?? [])\n\t\t})\n\t\twriteFunctions(pack.root.folder('data')!, pack.data.functions ?? [])\n\t\twriteJson(pack.root, 'pack.mcmeta', pack.meta.data, pack.meta.indent)\n\t\tconst blob = await pack.root.generateAsync({ type: 'blob', compression: 'DEFLATE' })\n\t\tconst url = URL.createObjectURL(blob)\n\t\tpack.status = 'done'\n\t\treturn url\n\t}\n\n\tfunction writeCategory(root: JSZip, category: string, data: PackFile[]) {\n\t\tdata.forEach(({ name, data, indent, error }) => {\n\t\t\tconst [namespace, path] = name.split(':')\n\t\t\tif (error) return\n\t\t\twriteJson(root, `${namespace}/${category}/${path}.json`, data, indent)\n\t\t})\n\t}\n\n\tfunction writeFunctions(root: JSZip, functions: PackFile[]) {\n\t\tfunctions.forEach(({ name, data }) => {\n\t\t\tconst [namespace, path] = name.split(':')\n\t\t\twriteText(root, `${namespace}/functions/${path}.mcfunction`, data.join('\\n'))\n\t\t})\n\t}\n\n\tfunction writeJson(zip: JSZip, path: string, data: any, indent?: string) {\n\t\tconst text = JSON.stringify(data, null, indent) + '\\n'\n\t\twriteText(zip, path, text)\n\t}\n\n\tfunction writeText(zip: JSZip, path: string, data: any) {\n\t\tzip.file(path, data)\n\t}\n\n\texport async function upgrade(pack: Pack, config: UpgradeConfig) {\n\t\tif (pack.status !== 'loaded') {\n\t\t\tthrow new Error(`Cannot upgrade pack with status '${pack.status}'.`)\n\t\t}\n\t\tconst ctx: FixContext = {\n\t\t\twarn: config.onWarning,\n\t\t\tprompt: config.onPrompt,\n\t\t\tsource: () => config.source,\n\t\t\ttarget: () => config.target,\n\t\t\tconfig: (key: keyof FixConfig) => config.features[key],\n\t\t\tread: (category: string, name: string) => {\n\t\t\t\treturn pack.data[category].find(f =>\n\t\t\t\t\tf.error !== undefined &&\n\t\t\t\t\tf.name.replace(/^minecraft:/, '') === name.replace(/^minecraft:/, ''))\n\t\t\t},\n\t\t\tcreate: (category: string, name: string, data: any) => {\n\t\t\t\tpack.data[category].push({\n\t\t\t\t\tname: name,\n\t\t\t\t\tindent: pack.meta.indent,\n\t\t\t\t\tdata,\n\t\t\t\t})\n\t\t\t},\n\t\t}\n\t\tawait Fixes(pack, ctx)\n\t\tpack.status = 'upgraded'\n\t}\n}\n\ntype UpgradeConfig = {\n\tfeatures: FixConfig,\n\tsource: Version,\n\ttarget: Version,\n\tonPrompt: FixContext['prompt'],\n\tonWarning: (message: string, files?: string[]) => unknown,\n}\n\nconst dec2hex = (dec: number) => ('0' + dec.toString(16)).substr(-2)\n\nexport function hexId(length = 12) {\n\tvar arr = new Uint8Array(length / 2)\n\twindow.crypto.getRandomValues(arr)\n\treturn Array.from(arr, dec2hex).join('')\n}\n\nexport function MockPack(): Pack {\n\tconst id = hexId()\n\treturn {\n\t\tid,\n\t\tname: `Pack${id}`,\n\t\troot: new JSZip(),\n\t\tstatus: 'loaded',\n\t\tmeta: {\n\t\t\tname: 'pack.mcmeta',\n\t\t\tdata: { pack: { pack_format: 8, description: '' } },\n\t\t},\n\t\tdata: {\n\t\t\t'worldgen/biome': [\n\t\t\t\t{\n\t\t\t\t\tname: 'test:plains',\n\t\t\t\t\tdata: { features: [ ['red'] ] },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'test:desert',\n\t\t\t\t\tdata: { features: [ ['black', 'red', 'yellow', 'green'] ] },\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'test:jungle',\n\t\t\t\t\tdata: { features: [ ['green', 'yellow', 'red'] ] },\n\t\t\t\t},\n\t\t\t],\n\t\t},\n\t}\n}\n","import { useEffect, useRef, useState } from 'preact/hooks'\nimport type { FixConfig } from '../Fix'\nimport { Pack } from '../Pack'\nimport type { Version } from '../Version'\nimport { Octicon } from './Octicon'\n\ntype AlertData = {\n\tmessage: string,\n\tfiles?: string[],\n\tinfo?: string[],\n}\n\ntype PromptData = {\n\ttitle: string,\n\tmessage?: string,\n\tactions: string[],\n\tinfo?: string[],\n}\n\ntype PackCardProps = {\n\tpack: Pack,\n\tconfig: FixConfig,\n\tsource: Version,\n\ttarget: Version,\n\tdoDownload: number,\n\tonError: (error: Error) => unknown,\n\tonRemove: () => unknown,\n\tonDone: () => unknown,\n}\nexport function PackCard({ pack, config, source, target, onError, onRemove, onDone, doDownload }: PackCardProps) {\n\tconst [status, setStatus] = useState('Loading...')\n\tconst [download, setDownload] = useState<string | null>(null)\n\tconst [alerts, setAlerts] = useState<AlertData[]>([])\n\tconst [error, setError] = useState<string | null>(null)\n\tconst [alertsHidden, setAlertsHidden] = useState(false)\n\tconst [prompt, setPrompt] = useState<PromptData | null>(null)\n\tconst downloadRef = useRef<HTMLAnchorElement>(null)\n\tconst promptDone = useRef<(value: string) => void>(() => {})\n\n\tconst downloadName = pack.name.replace(/\\.zip$/, `_${target}.zip`)\n\n\tconst onPrompt = (title: string, message?: string, actions?: string[], info?: string[]) => {\n\t\tsetPrompt({ title, message, actions: actions ?? ['Confirm'], info })\n\t\treturn new Promise<string>((res) => {\n\t\t\tpromptDone.current = (value) => {\n\t\t\t\tsetPrompt(null)\n\t\t\t\tres(value)\n\t\t\t}\n\t\t})\n\t}\n\n\tconst onWarning = (message: string, files?: string[], info?: string[]) => {\n\t\tsetTimeout(() => setAlerts(alerts => [...alerts, { message, files, info }]))\n\t}\n\n\tuseEffect(() => {\n\t\t(async () => {\n\t\t\ttry {\n\t\t\t\tsetStatus('Upgrading...')\n\t\t\t\tawait Pack.upgrade(pack, { features: config, source, target, onPrompt, onWarning })\n\t\t\t\tsetStatus('Zipping...')\n\t\t\t\tconst download = await Pack.toZip(pack)\n\t\t\t\tsetDownload(download)\n\t\t\t\tonDone()\n\t\t\t} catch (e: any) {\n\t\t\t\tonError(e)\n\t\t\t\tsetError('Error during upgrading')\n\t\t\t}\n\t\t})()\n\t}, [pack])\n\n\tconst toggleAlerts = () => {\n\t\tsetAlertsHidden(!alertsHidden)\n\t}\n\n\tuseEffect(() => {\n\t\tif (doDownload) {\n\t\t\tdownloadRef.current.click()\n\t\t}\n\t}, [doDownload])\n\n\treturn <div class=\"pack\">\n\t\t<div class=\"pack-head\">\n\t\t\t{download && <a class=\"pack-status download\" ref={downloadRef} href={download} download={downloadName} data-hover={`Download data pack for ${target}`}>\n\t\t\t\t{Octicon.download}\n\t\t\t</a>}\n\t\t\t{(!download && !error && !prompt) && <div class=\"pack-status loading\" data-hover={status}>\n\t\t\t\t{Octicon.sync}\n\t\t\t</div>}\n\t\t\t{!download && !error && prompt && <div class=\"pack-status prompt\" data-hover=\"Manual action required\">\n\t\t\t\t{Octicon.report}\n\t\t\t</div>}\n\t\t\t{(alerts.length > 0 || error) && <div class={`pack-status alert${error ? ' error' : ''}`} onClick={toggleAlerts} data-hover={error ?? 'There were issues upgrading'}>\n\t\t\t\t{Octicon.alert}\n\t\t\t</div>}\n\t\t\t<span class=\"pack-name\">{pack.name.replace(/\\.zip$/, '')}</span>\n\t\t\t<div class=\"pack-status remove\" onClick={onRemove}>\n\t\t\t\t{Octicon.x}\n\t\t\t</div>\n\t\t</div>\n\t\t{(prompt || (alerts.length > 0 && !alertsHidden)) && <div class=\"pack-body\">\n\t\t\t{prompt && <div class=\"pack-prompt\">\n\t\t\t\t<p class=\"prompt-title\">{prompt.title}</p>\n\t\t\t\t{prompt.message && <p class=\"prompt-message\">{prompt.message}</p>}\n\t\t\t\t<p>\n\t\t\t\t\t{prompt.actions.map(action => (\n\t\t\t\t\t\t<button onClick={() => promptDone.current(action)}>{action}</button>\n\t\t\t\t\t))}\n\t\t\t\t</p>\n\t\t\t\t{prompt.info?.map(line => <p class=\"prompt-info\">{line}</p>)}\n\t\t\t</div>}\n\t\t\t{(alerts.length > 0 && !alertsHidden) && alerts.map(({ message, files, info }) => <div class=\"pack-alert\">\n\t\t\t\t<div class={`alert-message ${message.startsWith('!') ? 'alert-error' : ''}`}>{message.replace(/\\!/, '')}</div>\n\t\t\t\t{files && files.length > 0 && <>\n\t\t\t\t\t<p>Affected files:</p>\n\t\t\t\t\t<div class=\"alert-files\">{files.map(file => <p>{file}</p>)}</div>\n\t\t\t\t</>}\n\t\t\t\t{info?.map(line => <p class=\"alert-info\">{line}</p>)}\n\t\t\t</div>)}\n\t\t</div>}\n\t</div>\n}\n","import { useRef } from 'preact/hooks'\nimport type { Version } from '../Version'\nimport { Versions } from '../Version'\n\ntype VersionPickerProps = {\n\tvalue: Version,\n\tonChange: (version: Version) => unknown,\n}\nexport function VersionPicker({ value, onChange }: VersionPickerProps) {\n\tconst select = useRef<HTMLSelectElement>(null)\n\tconst change = () => {\n\t\tonChange(select.current.value as Version)\n\t}\n\treturn <select class=\"version-picker\" ref={select} value={value} onChange={change}>\n\t\t{Versions.map(v => <option value={v}>{v}</option>)}\n\t</select>\n}\n","import { Version, Versions } from './Version'\n\ntype Config = {\n\tsource?: string,\n\ttarget?: string,\n}\n\nexport namespace Store {\n\tconst KEY = 'misode_upgrader_config'\n\n\tfunction get(): Config {\n\t\treturn JSON.parse(localStorage.getItem(KEY) ?? '{}')\n\t}\n\n\tfunction set(config: Partial<Config>) {\n\t\tconst data = { ...get(), ...config }\n\t\tlocalStorage.setItem(KEY, JSON.stringify(data))\n\t}\n\n\texport function getSource(): Version {\n\t\tconst source = get().source\n\t\tif (source && Versions.includes(source as Version)) {\n\t\t\treturn source as Version\n\t\t}\n\t\treturn Version.DEFAULT_SOURCE\n\t}\n\n\texport function setSource(source: Version) {\n\t\tset({ source })\n\t}\n\n\texport function getTarget(): Version {\n\t\tconst target = get().target\n\t\tif (target && Versions.includes(target as Version)) {\n\t\t\treturn target as Version\n\t\t}\n\t\treturn Version.DEFAULT_TARGET\n\t}\n\n\texport function setTarget(target: Version) {\n\t\tset({ target })\n\t}\n}\n","import { useState } from 'preact/hooks'\nimport { mapStackTrace } from 'sourcemapped-stacktrace'\nimport { Config } from './components/Config'\nimport { Octicon } from './components/Octicon'\nimport { PackCard } from './components/PackCard'\nimport { VersionPicker } from './components/VersionPicker'\nimport type { FixConfig } from './Fix'\nimport { hexId, Pack } from './Pack'\nimport { Store } from './Store'\nimport { Version } from './Version'\n\nexport type AppError = {\n\tid: string,\n\tprocess: 'loading' | 'upgrading',\n\terror: Error,\n\tstacktrace?: string,\n}\n\nexport function App() {\n\tconst [packs, setPacks] = useState<Pack[]>([])\n\tconst [errors, setErrors] = useState<AppError[]>([])\n\tconst [source, setSource] = useState<Version>(Store.getSource())\n\tconst [target, setTarget] = useState<Version>(Store.getTarget())\n\tconst [config, setConfig] = useState<FixConfig>({\n\t\tfunctions: true,\n\t\tids: true,\n\t\tpredicates: true,\n\t\tworldgen: true,\n\t\tpackFormat: true,\n\t\tfeatureCycles: true,\n\t})\n\tconst changeSource = (source: Version) => {\n\t\tStore.setSource(source)\n\t\tsetSource(source)\n\t}\n\tconst changeTarget = (target: Version) => {\n\t\tStore.setTarget(target)\n\t\tsetTarget(target)\n\t}\n\n\tconst addError = (process: 'loading' | 'upgrading', error: Error) => {\n\t\tconst id = hexId()\n\t\tconst stack = error.stack!.split('\\n').map(line => {\n\t\t\treturn line.replace(/^(\\s+)at (?:async )?(https?:.*)/, '$1at ($2)')\n\t\t})\n\t\tmapStackTrace(stack.join('\\n'), (mapped) => {\n\t\t\tconst stacktrace = stack[0] + '\\n' + mapped.map(line => {\n\t\t\t\treturn line.replace(/..\\/..\\/src\\//, 'src/')\n\t\t\t}).join('\\n')\n\t\t\tsetErrors(errors => errors.map(e => e.id === id ? { ...e, stacktrace } : e))\n\t\t})\n\t\tsetErrors([...errors, { id, process, error }])\n\t}\n\n\tconst onDrop = async (e: DragEvent) => {\n\t\te.preventDefault()\n\t\tif(!e.dataTransfer) return\n\n\t\tconst promises = []\n\t\tfor (let i = 0; i < e.dataTransfer.files.length; i++) {\n\t\t\tconst file = e.dataTransfer.files[i]\n\t\t\tif (file.type.match(/^application\\/(x-)?zip(-compressed)?$/)) {\n\t\t\t\tpromises.push(Pack.fromZip(file))\n\t\t\t}\n\t\t}\n\t\tif (promises.length === 0) {\n\t\t\taddError('loading', new Error('The dropped files contain no zip files. Please zip the data pack first.'))\n\t\t} else {\n\t\t\tconst newPacks = await Promise.all(promises.map(async promise => {\n\t\t\t\ttry {\n\t\t\t\t\treturn await promise\n\t\t\t\t} catch (error: any) {\n\t\t\t\t\taddError('loading', error)\n\t\t\t\t\tconsole.error(error)\n\t\t\t\t\treturn\n\t\t\t\t}\n\t\t\t}))\n\t\t\tsetPacks([...packs, ...newPacks.flat().filter((p): p is Pack => p !== undefined)])\n\t\t}\n\t}\n\n\tconst onUpgradeError = (error: Error) => {\n\t\tconsole.error(error)\n\t\taddError('upgrading', error)\n\t}\n\n\tconst removePack = (id: string) => {\n\t\tsetPacks(packs => packs.filter(p => p.id !== id))\n\t}\n\n\tconst [doDownload, setDownload] = useState(0)\n\n\treturn <main onDrop={onDrop} onDragOver={e => e.preventDefault()}>\n\t\t{packs.length > 0 && <>\n\t\t\t<div class=\"packs\">\n\t\t\t\t{packs.map(pack => <PackCard key={pack.id} {...{pack, config, source, target, doDownload}} onError={onUpgradeError} onRemove={() => removePack(pack.id)} onDone={() => setPacks([...packs])} />)}\n\t\t\t\t{packs.filter(p => p.status === 'done').length > 1 &&\n\t\t\t\t\t<button class=\"download-all\" onClick={() => setDownload(doDownload + 1)}>\n\t\t\t\t\t\t{Octicon.download}\n\t\t\t\t\t\t<span>Download all</span>\n\t\t\t\t\t</button>}\n\t\t\t</div>\n\t\t</>}\n\t\t<div class=\"drop\">\n\t\t\t<h1>Drop data pack here</h1>\n\t\t\t<p>Convert from <VersionPicker value={source} onChange={changeSource}/> to <VersionPicker value={target} onChange={changeTarget}/></p>\n\t\t\t{Version.order(target, source)\n\t\t\t\t? <p class=\"error-message\">Invalid version range</p>\n\t\t\t\t: Version.includes(source, target, '1.18.1', '1.18.2')\n\t\t\t\t\t? <p class=\"warning-message\">This upgrade is still being worked on</p>\n\t\t\t\t\t: null}\n\t\t</div>\n\t\t<div class=\"configs\">\n\t\t\t<Config name=\"Upgrade functions\" value={config.functions} onChange={v => setConfig({ ...config, functions: v })} />\n\t\t\t<Config name=\"Upgrade IDs\" value={config.ids} onChange={v => setConfig({ ...config, ids: v })} />\n\t\t\t<Config name=\"Upgrade JSON files\" value={config.predicates} onChange={v => setConfig({ ...config, predicates: v })} />\n\t\t\t<Config name=\"Upgrade worldgen\" value={config.worldgen} onChange={v => setConfig({ ...config, worldgen: v })} />\n\t\t\t<Config name=\"Upgrade pack_format\" value={config.packFormat} onChange={v => setConfig({ ...config, packFormat: v })} />\n\t\t\t<Config name=\"Detect feature cycles\" value={config.featureCycles} onChange={v => setConfig({ ...config, featureCycles: v })} />\n\t\t</div>\n\t\t<div class=\"footer\">\n\t\t\t<p>Developed by Misode</p>\n\t\t\t<p>Source code on <a href=\"https://github.com/misode/upgrader\" target=\"_blank\">GitHub</a></p>\n\t\t</div>\n\t\t<div class=\"main-errors\">\n\t\t\t{errors.map(e => {\n\t\t\t\tconst title = `${e.error.name}: ${e.error.message}`\n\t\t\t\tconst body = `An error occurred while ${e.process} a data pack.\\nData Pack: <!-- ATTACH YOUR DATAPACK HERE -->\\n\\n\\`\\`\\`\\n${e.stacktrace ?? e.error.stack}\\n\\`\\`\\`\\n`\n\t\t\t\tconst url = `https://github.com/misode/upgrader/issues/new?title=${encodeURIComponent(title)}&body=${encodeURIComponent(body)}\\n`\n\t\t\t\treturn <div class=\"main-error\">\n\t\t\t\t\t<p>Something went wrong {e.process} the data pack:</p>\n\t\t\t\t\t<p class=\"error-message\">{e.error.message}</p>\n\t\t\t\t\t<p>You can report this as a bug <a href={url} target=\"_blank\">on GitHub</a> and upload the data pack</p>\n\t\t\t\t\t<div class=\"error-close\" onClick={() => setErrors(errors.filter(f => f.id !== e.id))}>{Octicon.x}</div>\n\t\t\t\t</div>})}\n\t\t</div>\n\t</main>\n}\n","import { render } from 'preact'\nimport { App } from './App'\nimport './style.css'\n\nrender(<App/>, document.body)\n"],"names":["class","type","checked","value","onChange","e","target","name","alert","xmlns","viewBox","width","height","fill-rule","d","download","report","sync","x","Versions","Version","Fix","Fix2","Version2","version","indexOf","ord","order","before","after","includes","source","from","to","includesInclusive","all","fixes","async","pack","ctx","fix","onFile","category","file","data","error","fileCtx","__spreadProps","warn","message","replace","replaceAll","groupProblems","problems","groupCtx","files","forEach","push","entries","Set","when","key","config","assert","predicate","Error","versionInclusive","debug","Carver","fixCarver","carvers","air","liquid","lava_level","above_bottom","aquifers_enabled","y","min_inclusive","absolute","max_inclusive","below_top","inner","yScale","horizontal_radius_multiplier","vertical_radius_multiplier","floor_level","vertical_rotation","max_exclusive","shape","distance_factor","thickness","min","max","plateau","width_smoothness","horizontal_radius_factor","vertical_radius_default_factor","vertical_radius_center_factor","DimensionType","fixDimensionType","min_y","Feature","fixFeature","Array","isArray","starts","decorator","feature","targets","predicate_type","block_state","state","placer","block_placer","size","min_size","extra_size","max_empty_corners_allowed","fossil_processors","overlay_processors","fossil_structures","overlay_structures","r","radius","base","spread","Math","discard_chance_on_air_exposure","feature_false","feature_true","features","default","to_place","fixUniformInt","foliage_placer","k","foliage_provider","leaves_provider","force_dirt","dirt_provider","Name","sapling_provider","getSapling","Properties","stage","combinedDecorators","max_water_depth","heightmap","foliage","match","probability","chance","step","Number","isInteger","count","extra_count","extra_chance","c","min0","max0","outer","chance2","ceil","count2","bottom_offset","maximum","top_offset","min2","max2","cutoff","min3","max3","baseline","decorators","length","slice","replaceitemRegex","timeObjectiveRegex","Function","line","i","startsWith","Ids","fixTag","values","_","fixIds","NoiseSettings","fixNoiseSettings","generator","settings","bedrock_roof_position","bedrock_floor_position","min_surface_level","noise_caves_enabled","noodle_caves_enabled","deepslate_enabled","ore_veins_enabled","noise","Predicates","fixCondition","criteria","fixCriterion","pools","fixPool","conditions","entity","player","parent","partner","child","villager","zombie","projectile","shooter","victims","fixEntity","item","items","fixItem","damage","killing_blow","location","entered","exited","fixEntry","children","condition","source_entity","direct_entity","equipment","vehicle","targeted_entity","block","blocks","StructureFeature","fixStructureFeature","Fixes17","meta","pack_format","f","redirect","fixPlacedFeatureId","create","placement","player_spawn_friendly","filter","CarverRemovals","has","map","flatMap","replacement","str","id","FeatureReplacements","get","FeatureRenames","FeatureRenamesPlacement","FeatureOnlyConfig","read","FeatureFullyRemoved","fixFeatureId","find","p","placedFeature","FeatureOnlyPlacement","FeatureRenamesConfig","configuredFeature","log","fixToConfiguredFeature","collectDecorators","can_be_placed_on","b","fluid","barrier","spread_width","spread_height","fixToPlacedFeature","allowed_tree_position","max_height","vegetation_feature","__spreadValues","steps","floor_to_ceiling_search_range","direction_of_search","surface","target_condition","allowed_search_condition","allow_water","max_steps","factors","some","primeFactors","n","counts","fill","factorsToUse","pop","every","distribution","weight","round","fixDecorator","xz_spread","y_spread","divisor","Map","Object","birch_other","fossil","lake_lava","monster_room","ore_granite","ore_diorite","ore_andesite","ore_coal","ore_iron","ore_gold","ore_redstone","ore_diamond","ore_lapis","end_gateway","fancy_oak_bees_005","flower_forest","forest_flower_trees","forest_flower_vegetation","forest_flower_vegetation_common","grove_vegetation","mushroom_field_vegetation","ore_debris_large","patch_waterlilly","pine","plain_vegetation","rooted_azalea_trees","taiga_vegetation","trees_giant","trees_giant_spruce","trees_jungle_edge","trees_mountain","acacia","birch","brown_mushroom_giant","cave_vine","dark_oak","end_island","fancy_oak","flower_plain_decorated","meadow_trees","mega_jungle_tree","mega_pine","red_mushroom_giant","patch_cactus","mega_spruce","spruce","trees_mountain_edge","trees_shattered_savanna","crimson_fungi_planted","warped_fungi_planted","STEPS","surface_rule","sequence","s2","fixSurfaceRule","if_true","then_run","invert","offset","add_surface_depth","add_run_depth","add_surface_secondary_depth","surface_depth_multiplier","run_depth_multiplier","Fixes18","biomes","biomesWithDuplicates","biome","stepFeatures","index","add","depends","sortedFeatures","startFeatures","g","node","member","delete","findCycle","start","depth","dep","visitedFeatures","visitedBiomes","cycle2","cycle","startCandidates","clear","info","nextNode","Dimension","structure_overrides","structures","fixGenerator","infiniburn","island_noise_override","amplified","large_biomes","Fixes182","Advancement","trigger","distance","mergePlayerLocation","start_position","Biome","scale","surface_builder","splice","particle","effects","options","color","seed","preset","altitude_noise","temperature_noise","humidity_noise","weirdness_noise","parameters","temperature","humidity","continentalness","altitude","erosion","weirdness","fixBiomeSource","biome_source","legacy_random_source","top_slide","bottom_slide","simplex_surface_noise","random_density_offset","terrain_shaper","factor","jaggedness","density_offset","density_factor","rules","conditionType","conditionData","ifTrue","random_name","true_at_and_below","false_at_and_above","thenRun","result_state","axis","ruleType","ruleData","feature2","xspread","zspread","filters","can_replace","isNonEmptyList","whitelist","getBlockIds","blacklist","direction","allowed_placement","prioritize_tip","layers","provider","state_provider","tries","yspread","decorated","predicates","project","height_distribution","deltaIntProvider","Infinity","body_provider","head_provider","filters2","place_on","place_in","place_under","pointed_dripstone","chance_of_taller_dripstone","chance_of_directional_spread","chance_of_spread_radius2","chance_of_spread_radius3","max_placements","mean","deviation","delta","obj","states","Fixes21w44a","Fixes","categories","Pack","Pack2","text","loadText","indent","detectIndent","split","l2","join","JSON","parse","stripJsonComments","zip","path","stringify","fromZip","buffer","arrayBuffer","JSZip","loadAsync","metaFiles","endsWith","Promise","rootPath","metaFile","root","hexId","status","loadJson","matcher","RegExp","m","loadCategory","folder","functions","loadFunctions","loadPack","toZip","namespace","data2","blob","generateAsync","compression","url","URL","createObjectURL","upgrade","onWarning","prompt","onPrompt","dec2hex","dec","toString","substr","arr","Uint8Array","crypto","getRandomValues","onError","onRemove","onDone","doDownload","setStatus","useState","setDownload","alerts","setAlerts","setError","alertsHidden","setAlertsHidden","setPrompt","downloadRef","useRef","promptDone","downloadName","title","actions","res","current","alerts2","download2","click","ref","href","data-hover","Octicon","onClick","action","select","v","Store","packs","setPacks","errors","setErrors","setSource","getSource","setTarget","getTarget","setConfig","ids","worldgen","packFormat","featureCycles","addError","process","stack","mapped","stacktrace","errors2","onUpgradeError","onDrop","preventDefault","dataTransfer","promises","newPacks","promise","flat","onDragOver","PackCard","removePack","packs2","VersionPicker","source2","target2","Config","body","encodeURIComponent","Store2","KEY","getItem","setItem","DEFAULT_SOURCE","DEFAULT_TARGET","render","App","document"],"mappings":"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"}