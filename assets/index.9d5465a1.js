import{a as e,J as t,l as a,y as n,b as i,N as o}from"./vendor.ff4f6c89.js";const c={alert:e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},e("path",{"fill-rule":"evenodd",d:"M8.22 1.754a.25.25 0 00-.44 0L1.698 13.132a.25.25 0 00.22.368h12.164a.25.25 0 00.22-.368L8.22 1.754zm-1.763-.707c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0114.082 15H1.918a1.75 1.75 0 01-1.543-2.575L6.457 1.047zM9 11a1 1 0 11-2 0 1 1 0 012 0zm-.25-5.25a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5z"})),download:e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},e("path",{"fill-rule":"evenodd",d:"M7.47 10.78a.75.75 0 001.06 0l3.75-3.75a.75.75 0 00-1.06-1.06L8.75 8.44V1.75a.75.75 0 00-1.5 0v6.69L4.78 5.97a.75.75 0 00-1.06 1.06l3.75 3.75zM3.75 13a.75.75 0 000 1.5h8.5a.75.75 0 000-1.5h-8.5z"})),sync:e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},e("path",{"fill-rule":"evenodd",d:"M8 2.5a5.487 5.487 0 00-4.131 1.869l1.204 1.204A.25.25 0 014.896 6H1.25A.25.25 0 011 5.75V2.104a.25.25 0 01.427-.177l1.38 1.38A7.001 7.001 0 0114.95 7.16a.75.75 0 11-1.49.178A5.501 5.501 0 008 2.5zM1.705 8.005a.75.75 0 01.834.656 5.501 5.501 0 009.592 2.97l-1.204-1.204a.25.25 0 01.177-.427h3.646a.25.25 0 01.25.25v3.646a.25.25 0 01-.427.177l-1.38-1.38A7.001 7.001 0 011.05 8.84a.75.75 0 01.656-.834z"})),x:e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16"},e("path",{"fill-rule":"evenodd",d:"M3.72 3.72a.75.75 0 011.06 0L8 6.94l3.22-3.22a.75.75 0 111.06 1.06L9.06 8l3.22 3.22a.75.75 0 11-1.06 1.06L8 9.06l-3.22 3.22a.75.75 0 01-1.06-1.06L6.94 8 3.72 4.78a.75.75 0 010-1.06z"}))};var r,s;(s=r||(r={})).all=function(e){return(t,a)=>{e.forEach((e=>e(t,a)))}},s.onFile=function(e,t){return(a,n)=>{for(const[o,c]of Object.entries(a.data[e])){const a={warn:e=>n.warn(`${o} ${e}`)};try{t(c,a)}catch(i){const t=new Error(`Error fixing ${e.replace(/^worldgen\//,"").replaceAll("_"," ")} ${o}: ${i.message}`);throw t.stack=i.stack,t}}}};const l=r.all([r.onFile("worldgen/configured_carver",f),r.onFile("worldgen/biome",(e=>{var t,a;"object"==typeof e.carvers&&(null==(t=e.carvers.air)||t.forEach(f),null==(a=e.carvers.liquid)||a.forEach(f))}))]);function f(e){if("object"!=typeof e)return;const t=e.type.replace(/^minecraft:/,"");e.config.lava_level={above_bottom:10},e.config.aquifers_enabled=!1,"cave"===t||"underwater_cave"===t||"nether_cave"===t?(e.config.y="nether_cave"===t?{type:"minecraft:uniform",min_inclusive:{absolute:0},max_inclusive:{below_top:1}}:{type:"minecraft:biased_to_bottom",min_inclusive:{absolute:0},max_inclusive:{absolute:127},inner:8},e.config.yScale=.5,e.config.horizontal_radius_multiplier=1,e.config.vertical_radius_multiplier=1,e.config.floor_level=-.7):(e.config.y={type:"minecraft:biased_to_bottom",min_inclusive:{absolute:20},max_inclusive:{absolute:67},inner:8},e.config.yScale=3,"canyon"===t&&(e.config.vertical_rotation={type:"minecraft:uniform",value:{min_inclusive:-.125,max_exclusive:.125}},e.config.shape={distance_factor:{type:"minecraft:uniform",value:{min_inclusive:.75,max_exclusive:1}},thickness:{type:"minecraft:trapezoid",value:{min:0,max:6,plateau:2}},width_smoothness:3,horizontal_radius_factor:{type:"minecraft:uniform",value:{min_inclusive:.75,max_exclusive:1}},vertical_radius_default_factor:1,vertical_radius_center_factor:0}))}const p=r.all([r.onFile("dimension_type",u),r.onFile("dimension",(e=>{"object"==typeof e.type&&u(e.type)}))]);function u(e){e.min_y=0,e.height=256}const m=r.all([r.onFile("worldgen/configured_feature",d),r.onFile("worldgen/biome",(e=>{Array.isArray(e.starts)&&e.starts.forEach(d)}))]);function d(e,t){if("object"!=typeof e)return;switch(e.type.replace(/^minecraft:/,"")){case"basalt_columns":g(e.config,"reach"),g(e.config,"height");break;case"decorated":!function(e,t){if("object"!=typeof e)return;switch(e.type.replace(/^minecraft:/,"")){case"carving_mask":if(0===e.config.probability){e.type="minecraft:nope",e.config={};break}const t=1/e.config.probability;e.type="minecraft:decorated",e.config=b({type:"minecraft:carving_mask",config:{step:e.config.step}},...Number.isInteger(t)?[{type:"minecraft:chance",config:{chance:t}}]:[{type:"minecraft:count_extra",config:{count:0,extra_count:1,extra_chance:e.config.probability}}]),delete e.config.probability;break;case"heightmap_world_surface":e.type="minecraft:heightmap",e.config={heightmap:"WORLD_SURFACE_WG"};break;case"top_solid_heightmap":e.type="minecraft:heightmap",e.config={heightmap:"OCEAN_FLOOR_WG"};break;case"heightmap":case"heightmap_spread_double":e.config={heightmap:"MOTION_BLOCKING"};break;case"water_lake":e.type="minecraft:decorated",e.config=b({type:"minecraft:chance",config:{chance:e.config.chance}},{type:"minecraft:square",config:{}},{type:"minecraft:range",config:{height:{type:"minecraft:biased_to_bottom",min_inclusive:{absolute:0},max_inclusive:{absolute:256},inner:8}}});break;case"lava_lake":const a=e.config.chance/10;e.type="minecraft:decorated",e.config=b(...Number.isInteger(a)?[{type:"minecraft:chance",config:{chance:a}}]:[{type:"minecraft:count_extra",config:{count:0,extra_count:1,extra_chance:1/a}}],{type:"minecraft:square",config:{}},{type:"minecraft:range",config:{height:{type:"minecraft:biased_to_bottom",min_inclusive:{absolute:0},max_inclusive:{absolute:256},inner:8}}},{type:"minecraft:lava_lake",config:{chance:10}});break;case"fire":const n="number"==typeof e.config.count?e.config.count:e.config.count.base+e.config.count.spread/2;e.type="minecraft:decorated",e.config=b({type:"minecraft:count",config:{count:{type:"minecraft:biased_to_bottom",value:{min_inclusive:0,max_inclusive:Math.ceil(n/2)}}}},{type:"minecraft:square",config:{}},{type:"minecraft:range",config:{height:{type:"minecraft:uniform",min_inclusive:{absolute:4},max_inclusive:{absolute:252}}}});break;case"glowstone":const i="number"==typeof e.config.count?e.config.count:e.config.count.base+e.config.count.spread/2;e.type="minecraft:decorated",e.config=b({type:"minecraft:count",config:{count:{type:"minecraft:biased_to_bottom",value:{min_inclusive:0,max_inclusive:Math.ceil(i-1)}}}},{type:"minecraft:square",config:{}},{type:"minecraft:range",config:{height:{type:"minecraft:uniform",min_inclusive:{absolute:4},max_inclusive:{absolute:252}}}});break;case"range":const o=e.config.bottom_offset,c=e.config.bottom_offset+e.config.maximum-e.config.top_offset-1;if(o===c){e.config={height:o};break}e.config={height:{type:"minecraft:uniform",min_inclusive:{absolute:o},max_inclusive:{absolute:c}}};break;case"range_biased":const r=e.config.bottom_offset,s=e.config.bottom_offset+e.config.maximum-e.config.top_offset-1;e.config={height:{type:"minecraft:biased_to_bottom",min_inclusive:{absolute:r},max_inclusive:{absolute:s},cutoff:r}};break;case"range_very_biased":const l=e.config.bottom_offset,f=e.config.bottom_offset+e.config.maximum-e.config.top_offset-1;e.config={height:{type:"minecraft:very_biased_to_bottom",min_inclusive:{absolute:l},max_inclusive:{absolute:f},cutoff:r}};break;case"depth_average":e.type="minecraft:range",e.config={height:{type:"minecraft:trapezoid",min_inclusive:{absolute:e.config.baseline},max_inclusive:{absolute:e.config.baseline+e.config.spread}}}}}(e.config.decorator),d(e.config.feature,t);break;case"delta_feature":g(e.config,"size"),g(e.config,"rim_size");break;case"disk":case"ice_patch":g(e.config,"radius");break;case"flower":case"no_bonemeal_flower":case"random_patch":const a=e.config.block_placer;"column_placer"===a.type.replace(/^minecraft:/,"")&&(a.size={type:"minecraft:uniform",value:{min_inclusive:a.min_size,max_inclusive:a.min_size+a.extra_size}},delete a.min_size,delete a.extra_size);break;case"netherrack_replace_blobs":let n=e.config.radius.base,i=e.config.radius.base+e.config.radius.spread;if(i>12&&(t.warn(`Feature "netherrack_replace_blobs" radius ${i} is greater than 12 and could not be perfectly upgraded. Consider increasing the count of this feature.`),n=Math.min(12,n),i=Math.min(12,i)),n===i){e.config.radius=n;break}e.config.radius={type:"minecraft:uniform",value:{min_inclusive:n,max_inclusive:i}};break;case"no_surface_ore":_(e),e.config.discard_chance_on_air_exposure=1;break;case"ore":_(e);break;case"sea_pickle":g(e.config,"count");break;case"simple_block":e.config.to_place={type:"minecraft:simple_state_provider",state:e.config.to_place};break;case"tree":["radius","offset","crown_height","height","trunk_height"].forEach((t=>g(e.config.foliage_placer,t))),e.config.foliage_provider=e.config.leaves_provider,delete e.config.leaves_provider,e.config.force_dirt=!1,e.config.dirt_provider={type:"minecraft:simple_state_provider",state:{Name:"minecraft:dirt"}},e.config.sapling_provider={type:"minecraft:simple_state_provider",state:{Name:h(e.config.foliage_provider)}},e.type="minecraft:decorated",e.config={decorator:{type:"decorated",config:b({type:"minecraft:water_depth_threshold",config:{max_water_depth:e.config.max_water_depth}},{type:"minecraft:heightmap",config:{heightmap:e.config.heightmap}})},feature:{type:"minecraft:tree",config:e.config}},delete e.config.feature.config.max_water_depth,delete e.config.feature.config.heightmap}}function g(e,t){"object"==typeof(null==e?void 0:e[t])&&(e[t]={type:"minecraft:uniform",value:{min_inclusive:e[t].base,max_inclusive:e[t].base+e[t].spread}})}function _(e){e.config.discard_chance_on_air_exposure=0,e.config.targets=[{target:e.config.target,state:e.config.state}],delete e.config.target,delete e.config.state}function h(e){if("simple_state_provider"===e.type.replace(/^minecraft:/,"")){const t=e.state.Name.match(/^(?:minecraft:)?()_leaves/);if(t)return`minecraft:${t[1]}_sapling`}return"minecraft:oak_sapling"}function b(...e){return{outer:e[0],inner:2===e.length?e[1]:{type:"minecraft:decorated",config:b(...e.slice(1))}}}const v=r.all([r.onFile("worldgen/noise_settings",y),r.onFile("dimension",(e=>{var t,a;"noise"===(null==(a=null==(t=e.generator)?void 0:t.type)?void 0:a.replace(/^minecraft:/,""))&&y(e.generator.settings)}))]);function y(e){"object"==typeof e&&(e.bedrock_roof_position<=-10&&(e.bedrock_roof_position=-2147483648),e.bedrock_floor_position<=-10&&(e.bedrock_floor_position=-2147483648),e.min_surface_level=0,e.noise_caves_enabled=!1,e.noodle_caves_enabled=!1,e.aquifers_enabled=!1,e.deepslate_enabled=!1,e.ore_veins_enabled=!1,e.noise.min_y=0)}const w=r.all([r.onFile("predicates",(e=>{Array.isArray(e)?e.forEach(z):z(e)})),r.onFile("advancements",(e=>{Object.values(e.criteria).forEach(k)})),r.onFile("loot_tables",(e=>{var t;null==(t=e.pools)||t.forEach(x)}))]);function k(e){var t,a;"object"==typeof e.conditions&&(j(e.conditions.entity),j(e.conditions.player),j(e.conditions.parent),j(e.conditions.partner),j(e.conditions.child),j(e.conditions.villager),j(e.conditions.zombie),j(e.conditions.projectile),j(e.conditions.shooter),null==(t=e.conditions.victims)||t.forEach(j),O(e.conditions.item),null==(a=e.conditions.items)||a.forEach(O),$(e.conditions.damage),$(e.conditions.killing_blow),A(e.conditions.location),A(e.conditions.entered),A(e.conditions.exited))}function x(e){var t,a;null==(t=e.entries)||t.forEach(E),null==(a=e.conditions)||a.forEach(z)}function E(e){var t,a;null==(t=e.children)||t.forEach(E),null==(a=e.conditions)||a.forEach(z)}function z(e){switch(e.condition.replace(/^minecraft:/,"")){case"match_tool":O(e.predicate);break;case"entity_properties":j(e.predicate);break;case"damage_source_properties":$(e.predicate);break;case"location_check":A(e.predicate)}}function $(e){"object"==typeof e&&(j(e.source_entity),j(e.direct_entity),$(e.type))}function j(e){"object"==typeof e&&(Array.isArray(e)?e.forEach(z):(e.equipment&&Object.values(e.equipment).forEach(O),j(e.vehicle),j(e.targeted_entity),A(e.location)))}function A(e){"object"==typeof e&&function(e){if("object"!=typeof e)return;e.block&&(e.blocks=[e.block],delete e.block)}(e.block)}function O(e){"object"==typeof e&&e.item&&(e.items=[e.item],delete e.item)}function F(e){if("object"!=typeof e)return;"nether_fossil"===e.type.replace(/^minecraft:/,"")&&(e.config||(e.config={}),e.config.height={type:"minecraft:uniform",min_inclusive:{absolute:32},max_inclusive:{below_top:2}})}const L=[p,v,r.all([r.onFile("worldgen/configured_structure_feature",F),r.onFile("worldgen/biome",(e=>{Array.isArray(e.starts)&&e.starts.forEach(F)}))]),l,m,w,e=>{e.meta.pack.pack_format=7}],C=["advancements","dimension","dimension_type","loot_tables","predicates","worldgen/biome","worldgen/configured_carver","worldgen/configured_feature","worldgen/configured_structure_feature","worldgen/configured_surface_builder","worldgen/noise_settings","worldgen/processor_list","worldgen/template_pool"];var M;function D({pack:t,onError:i}){const[o,r]=a(null),[s,l]=a([]),[f,p]=a(null),[u,m]=a(!1),d=t.name.replace(/\.zip$/,"_1_17.zip");n((()=>{(async()=>{try{const{warnings:e}=await M.upgrade(t);e&&l(e);const a=await M.toZip(t);r(a)}catch(e){i(e),p("Error during upgrading")}})()}),[t]);return e("div",{class:"pack"},e("div",{class:"pack-head"},o&&e("a",{class:"pack-status download",href:o,download:d,"data-hover":"Download data pack for 1.17"},c.download),!o&&!f&&e("div",{class:"pack-status loading"},c.sync),(o&&s.length>0||f)&&e("div",{class:"pack-status alert"+(f?" error":""),onClick:()=>{m(!u)},"data-hover":null!=f?f:"There were issues upgrading"},c.alert),e("span",{class:"pack-name"},t.name.replace(/\.zip$/,""))),o&&s&&!u&&e("div",{class:"pack-body"},s.map((t=>e("div",{class:"pack-alert"},t)))))}function N(){const[t,n]=a([]),[o,r]=a([]),s=e=>{console.error(e),r([...o,{process:"upgrading",error:e}])};return e("main",{onDrop:async e=>{if(e.preventDefault(),!e.dataTransfer)return;const a=[];for(let t=0;t<e.dataTransfer.files.length;t++){const n=e.dataTransfer.files[t];n.type.match(/^application\/(x-)?zip(-compressed)?$/)&&a.push(M.fromZip(n))}if(a.length>0){const e=await Promise.all(a.map((async e=>{try{return await e}catch(t){return r([...o,{process:"loading",error:t}]),void console.error(t)}})));n([...t,...e.filter((e=>void 0!==e))])}},onDragOver:e=>e.preventDefault()},0===t.length?e(i,null,e("div",{class:"drop"},e("h1",null,"Drop data pack here"),e("p",null,"Converts from 1.16.5 to 1.17"))):e(i,null,e("div",{class:"packs"},t.map((t=>e(D,{pack:t,onError:s})))),e("div",{class:"footer"},e("p",null,"Developed by Misode"),e("p",null,"Source code on ",e("a",{href:"https://github.com/misode/upgrader",target:"_blank"},"GitHub")))),e("div",{class:"main-errors"},o.map((t=>{const a=`${t.error.name}: ${t.error.message}`,n=`An error occurred while ${t.process} a data pack.\nData Pack: \x3c!-- ATTACH YOUR DATAPACK HERE --\x3e\n\n\`\`\`\n${t.error.stack}\n\`\`\`\n`,i=`https://github.com/misode/upgrader/issues/new?title=${encodeURIComponent(a)}&body=${encodeURIComponent(n)}\n`;return e("div",{class:"main-error"},e("p",null,"Something went wrong ",t.process," the data pack:"),e("p",{class:"error-message"},t.error.message),e("p",null,"You can report this as a bug ",e("a",{href:i,target:"_blank"},"on GitHub")," and upload the data pack"),e("div",{class:"error-close",onClick:()=>r(o.filter((e=>e.error.message!==t.error.message||e.process!==t.process)))},c.x))}))))}!function(e){async function a(e,t){const a=e.files[t];if(!a)throw new Error(`Cannot find "${t}".`);try{let e=await a.async("text");return e=e.split("\n").map((e=>e.replace(/^([^"\/]+)\/\/.*/,"$1"))).join("\n"),JSON.parse(e)}catch(n){throw new Error(`Cannot parse "${t}": ${n.message}.`)}}function n(e,t,a){const n=JSON.stringify(a,null,2)+"\n";e.file(t,n)}e.fromZip=async function(e){const n=await e.arrayBuffer(),i=await t.loadAsync(n),o={name:e.name,zip:i,data:{}};return await Promise.all(C.map((async e=>{o.data[e]=await async function(e,t){const n=new RegExp(`^data/([^/]+)/${t}/(.*).json$`);return Object.fromEntries(await Promise.all(Object.keys(e.files).map((e=>e.match(n))).filter((e=>e)).map((async t=>[`${t[1]}:${t[2]}`,await a(e,t[0])]))))}(i,e)}))),o.meta=await a(i,"pack.mcmeta"),console.warn(o),o},e.toZip=async function(e){C.forEach((t=>{!function(e,t,a){Object.entries(a).forEach((([a,i])=>{const[o,c]=a.split(":");n(e,`data/${o}/${t}/${c}.json`,i)}))}(e.zip,t,e.data[t])})),n(e.zip,"pack.mcmeta",e.meta);const t=await e.zip.generateAsync({type:"blob"});return URL.createObjectURL(t)},e.upgrade=async function(e){if(7===e.meta.pack.pack_format)return{warnings:["This pack already has pack_format 7 and cannot be upgraded."]};const t=[],a={warn:e=>t.push(e)};for(const n of L)n(e,a);return{warnings:t}}}(M||(M={}));o(e(N,null),document.body);
